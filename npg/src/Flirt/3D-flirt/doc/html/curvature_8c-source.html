<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>flirt: curvature.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">home</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">ens</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">flirtproj</a>&nbsp;/&nbsp;<a class="el" href="dir_000004.html">flirt</a></div>
<h1>curvature.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include "<a class="code" href="curvature_8h.html">curvature.h</a>"</span>
00002 
00003 
00004 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00005 <span class="preprocessor">#include &lt;math.h&gt;</span>
00006 <span class="preprocessor">#include "fftw3.h"</span>
00007 
00008 
00009 <span class="keywordtype">void</span> printDeltaPlan(<a class="code" href="structdelta_plan__t.html">deltaPlan</a> p) {
00010   printf(<span class="stringliteral">"-- deltaPlan at %p\n"</span>,p);
00011   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"forward"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o0">forward</a>);
00012   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"backward"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o1">backward</a>);
00013   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"in"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>);
00014   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"out"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>);
00015   printf(<span class="stringliteral">"%30s : %g\n"</span>,<span class="stringliteral">"fftw_normfac"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o2">fftw_normfac</a>);
00016   printf(<span class="stringliteral">"%30s : %d\n"</span>,<span class="stringliteral">"dim"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o5">dim</a>);
00017   printf(<span class="stringliteral">"%30s : %d\n"</span>,<span class="stringliteral">"m1"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o6">m1</a>);
00018   printf(<span class="stringliteral">"%30s : %d\n"</span>,<span class="stringliteral">"m2"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o7">m2</a>);
00019   printf(<span class="stringliteral">"%30s : %d\n"</span>,<span class="stringliteral">"m3"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o8">m3</a>);
00020   printf(<span class="stringliteral">"%30s : %d\n"</span>,<span class="stringliteral">"m"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o9">m</a>);
00021   printf(<span class="stringliteral">"%30s : %g\n"</span>,<span class="stringliteral">"h1"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o10">h1</a>);
00022   printf(<span class="stringliteral">"%30s : %g\n"</span>,<span class="stringliteral">"h2"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o11">h2</a>);
00023   printf(<span class="stringliteral">"%30s : %g\n"</span>,<span class="stringliteral">"h3"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o12">h3</a>);
00024   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"lambda1"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o13">lambda1</a>);
00025   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"lambda2"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o14">lambda2</a>);
00026   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"lambda3"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o15">lambda3</a>);
00027   printf(<span class="stringliteral">"%30s : %s\n"</span>,<span class="stringliteral">"bc"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o16">bc</a> == NEUMANN ? <span class="stringliteral">"NEUMANN"</span> : <span class="stringliteral">"DIRICHLET"</span>);
00028   printf(<span class="stringliteral">"%30s : %s\n"</span>,<span class="stringliteral">"gs"</span>,p-&gt;<a class="code" href="structdelta_plan__t.html#o17">gs</a> == MIDPOINT ? <span class="stringliteral">"MIDPOINT"</span> : <span class="stringliteral">"GRIDPOINT"</span>);
00029 };
00030 
00031 <a class="code" href="structdelta_plan__t.html">deltaPlan</a> createDeltaPlan2D(<span class="keywordtype">int</span> m1, 
00032                             <span class="keywordtype">int</span> m2,
00033                             <span class="keywordtype">double</span> h1,
00034                             <span class="keywordtype">double</span> h2,
00035                             boundary_t bc,
00036                             gridsymmetry_t gs) {
00037 
00038 
00039   <span class="keywordtype">int</span> j1,j2,k;
00040   <a class="code" href="structdelta_plan__t.html">deltaPlan</a> plan = (<a class="code" href="structdelta_plan__t.html">deltaPlan</a>) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structdelta_plan__t.html">deltaPlan_t</a>));  
00041 
00042   plan-&gt;<a class="code" href="structdelta_plan__t.html#o5">dim</a>     = 2;
00043   plan-&gt;<a class="code" href="structdelta_plan__t.html#o6">m1</a>      = m1;
00044   plan-&gt;<a class="code" href="structdelta_plan__t.html#o7">m2</a>      = m2;
00045   plan-&gt;<a class="code" href="structdelta_plan__t.html#o8">m3</a>      = 1;
00046   plan-&gt;<a class="code" href="structdelta_plan__t.html#o9">m</a>       = m1*m2;
00047   plan-&gt;<a class="code" href="structdelta_plan__t.html#o10">h1</a>      = h1;
00048   plan-&gt;<a class="code" href="structdelta_plan__t.html#o11">h2</a>      = h2;
00049   plan-&gt;<a class="code" href="structdelta_plan__t.html#o12">h3</a>      = 0.0;
00050   plan-&gt;<a class="code" href="structdelta_plan__t.html#o16">bc</a>      = bc;
00051   plan-&gt;<a class="code" href="structdelta_plan__t.html#o17">gs</a>      = gs;
00052   plan-&gt;<a class="code" href="structdelta_plan__t.html#o13">lambda1</a> = (<span class="keywordtype">double</span>*) fftw_malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * m1);
00053   plan-&gt;<a class="code" href="structdelta_plan__t.html#o14">lambda2</a> = (<span class="keywordtype">double</span>*) fftw_malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * m2);
00054   plan-&gt;<a class="code" href="structdelta_plan__t.html#o15">lambda3</a> = NULL;
00055   plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>      = (<span class="keywordtype">double</span>*) fftw_malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*m1*m2);
00056   plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>     = (<span class="keywordtype">double</span>*) fftw_malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*m1*m2);
00057 
00058 
00059   <span class="keywordflow">switch</span> (gs) {
00060   <span class="keywordflow">case</span> <a class="code" href="defs_8h.html#a9a7">MIDPOINT</a>: <span class="keywordflow">switch</span> (bc) {
00061     <span class="keywordflow">case</span> <a class="code" href="defs_8h.html#a8a4">NEUMANN</a>: <span class="comment">/* midpoint symmetry + neumann bc; forward=dct2, backward=dct3 */</span>
00062       plan-&gt;<a class="code" href="structdelta_plan__t.html#o2">fftw_normfac</a> = 1.0 / ((double) (2*m1 * 2*m2));
00063       plan-&gt;<a class="code" href="structdelta_plan__t.html#o0">forward</a>  = fftw_plan_r2r_2d(m1,m2, plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>, plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>, FFTW_REDFT10, FFTW_REDFT10, FFTW_ESTIMATE);
00064       plan-&gt;<a class="code" href="structdelta_plan__t.html#o1">backward</a> = fftw_plan_r2r_2d(m1,m2, plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>, plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>, FFTW_REDFT01, FFTW_REDFT01, FFTW_ESTIMATE);
00065       <span class="keywordflow">for</span> (k=0; k&lt;m1 ; ++k) 
00066         plan-&gt;lambda1[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)k)*PI / ((<span class="keywordtype">double</span>)m1) ));
00067       for (k=0; k&lt;m2 ; ++k) 
00068         plan-&gt;lambda2[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)k)*PI / ((<span class="keywordtype">double</span>)m2) ));
00069       break;
00070     
00071     case DIRICHLET: <span class="comment">/* midpoint symmetry + dirichlet bc forward=dst2, backward=dst3*/</span>
00072       plan-&gt;fftw_normfac = 1.0 / ((<span class="keywordtype">double</span>) (2*m1 * 2*m2));
00073       plan-&gt;forward  = fftw_plan_r2r_2d(m1,m2, plan-&gt;in, plan-&gt;out, FFTW_RODFT10, FFTW_RODFT10, FFTW_ESTIMATE);
00074       plan-&gt;backward = fftw_plan_r2r_2d(m1,m2, plan-&gt;in, plan-&gt;out, FFTW_RODFT01, FFTW_RODFT01, FFTW_ESTIMATE);
00075     for (k=0; k&lt;m1 ; ++k) 
00076        plan-&gt;lambda1[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)(k+1))*PI / ((<span class="keywordtype">double</span>)m1) ));
00077     for (k=0; k&lt;m2 ; ++k) 
00078        plan-&gt;lambda2[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)(k+1))*PI / ((<span class="keywordtype">double</span>)m2) ));
00079     break;
00080     }
00081 
00082   case GRIDPOINT: switch (bc) {
00083     
00084     <span class="keywordflow">case</span> <a class="code" href="defs_8h.html#a8a4">NEUMANN</a>:<span class="comment">/* gridpoint symmetry + neumann bc forward=backward=dct1*/</span>
00085       plan-&gt;<a class="code" href="structdelta_plan__t.html#o2">fftw_normfac</a> = 1.0 / ((double) (2*(m1-1) * 2*(m2-1)));
00086       plan-&gt;<a class="code" href="structdelta_plan__t.html#o0">forward</a>  = fftw_plan_r2r_2d(m1,m2, plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>, plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>, FFTW_REDFT00, FFTW_REDFT00, FFTW_ESTIMATE);
00087       plan-&gt;<a class="code" href="structdelta_plan__t.html#o1">backward</a> = fftw_plan_r2r_2d(m1,m2, plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>, plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>, FFTW_REDFT00, FFTW_REDFT00, FFTW_ESTIMATE);
00088       <span class="keywordflow">for</span> (k=0; k&lt;m1 ; ++k) 
00089         plan-&gt;lambda1[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)k)*PI / ((<span class="keywordtype">double</span>)(m1-1)) ));
00090       for (k=0; k&lt;m2 ; ++k) 
00091         plan-&gt;lambda2[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)k)*PI / ((<span class="keywordtype">double</span>)(m2-1)) ));
00092       break;
00093     
00094     case DIRICHLET:<span class="comment">/* gridpoint symmetry + dirichlet bc forward=backward=dst1*/</span>
00095       plan-&gt;fftw_normfac = 1.0 / ((<span class="keywordtype">double</span>) (2*(m1+1) * 2*(m2+1)));
00096       plan-&gt;forward  = fftw_plan_r2r_2d(m1,m2, plan-&gt;in, plan-&gt;out, FFTW_RODFT00, FFTW_RODFT00, FFTW_ESTIMATE);
00097       plan-&gt;backward = fftw_plan_r2r_2d(m1,m2, plan-&gt;in, plan-&gt;out, FFTW_RODFT00, FFTW_RODFT00, FFTW_ESTIMATE );
00098       for (k=0; k&lt;m1 ; ++k) 
00099         plan-&gt;lambda1[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)(k+1))*PI / ((<span class="keywordtype">double</span>)(m1+1)) ));
00100       for (k=0; k&lt;m2 ; ++k) 
00101         plan-&gt;lambda2[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)(k+1))*PI / ((<span class="keywordtype">double</span>)(m2+1)) ));
00102       break;
00103     };
00104   }
00105   
00106   return plan;
00107 
00108 };
00109 
00110 
00111 
00112 <a class="code" href="structdelta_plan__t.html">deltaPlan</a> createDeltaPlan3D(<span class="keywordtype">int</span> m1, 
00113                             <span class="keywordtype">int</span> m2,
00114                             <span class="keywordtype">int</span> m3,
00115                             <span class="keywordtype">double</span> h1,
00116                             <span class="keywordtype">double</span> h2,
00117                             <span class="keywordtype">double</span> h3,
00118                             boundary_t bc,
00119                             gridsymmetry_t gs) {
00120   
00121   <span class="keywordtype">int</span> k;
00122   <a class="code" href="structdelta_plan__t.html">deltaPlan</a> plan = (<a class="code" href="structdelta_plan__t.html">deltaPlan</a>) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structdelta_plan__t.html">deltaPlan_t</a>));  
00123 
00124   plan-&gt;<a class="code" href="structdelta_plan__t.html#o5">dim</a>     = 3;
00125   plan-&gt;<a class="code" href="structdelta_plan__t.html#o6">m1</a>      = m1;
00126   plan-&gt;<a class="code" href="structdelta_plan__t.html#o7">m2</a>      = m2;
00127   plan-&gt;<a class="code" href="structdelta_plan__t.html#o8">m3</a>      = m3;
00128   plan-&gt;<a class="code" href="structdelta_plan__t.html#o9">m</a>       = m1*m2*m3;
00129   plan-&gt;<a class="code" href="structdelta_plan__t.html#o10">h1</a>      = h1;
00130   plan-&gt;<a class="code" href="structdelta_plan__t.html#o11">h2</a>      = h2;
00131   plan-&gt;<a class="code" href="structdelta_plan__t.html#o12">h3</a>      = h3;
00132   plan-&gt;<a class="code" href="structdelta_plan__t.html#o16">bc</a>      = bc;
00133   plan-&gt;<a class="code" href="structdelta_plan__t.html#o17">gs</a>      = gs;
00134   plan-&gt;<a class="code" href="structdelta_plan__t.html#o13">lambda1</a> = (<span class="keywordtype">double</span>*) fftw_malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * m1);
00135   plan-&gt;<a class="code" href="structdelta_plan__t.html#o14">lambda2</a> = (<span class="keywordtype">double</span>*) fftw_malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * m2);
00136   plan-&gt;<a class="code" href="structdelta_plan__t.html#o15">lambda3</a> = (<span class="keywordtype">double</span>*) fftw_malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * m3);
00137   plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>      = (<span class="keywordtype">double</span>*) fftw_malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*m1*m2*m3);
00138   plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>     = (<span class="keywordtype">double</span>*) fftw_malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*m1*m2*m3);
00139 
00140 
00141   <span class="keywordflow">switch</span> (gs) {
00142   <span class="keywordflow">case</span> <a class="code" href="defs_8h.html#a9a7">MIDPOINT</a>: <span class="keywordflow">switch</span> (bc) {
00143     <span class="keywordflow">case</span> <a class="code" href="defs_8h.html#a8a4">NEUMANN</a>: <span class="comment">/* midpoint symmetry + neumann bc; forward=dct2, backward=dct3 */</span>
00144       plan-&gt;<a class="code" href="structdelta_plan__t.html#o2">fftw_normfac</a> = 1.0 / ((double) (2*m1 * 2*m2 * 2*m3));
00145       plan-&gt;<a class="code" href="structdelta_plan__t.html#o0">forward</a>  = fftw_plan_r2r_3d(m1,m2,m3, plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>, plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>, FFTW_REDFT10, FFTW_REDFT10, FFTW_REDFT10, FFTW_ESTIMATE);
00146       plan-&gt;<a class="code" href="structdelta_plan__t.html#o1">backward</a> = fftw_plan_r2r_3d(m1,m2,m3, plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>, plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>, FFTW_REDFT01, FFTW_REDFT01, FFTW_REDFT01, FFTW_ESTIMATE);
00147       <span class="keywordflow">for</span> (k=0; k&lt;m1 ; ++k) 
00148         plan-&gt;lambda1[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)k)*PI / ((<span class="keywordtype">double</span>)m1) ));
00149       for (k=0; k&lt;m2 ; ++k) 
00150         plan-&gt;lambda2[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)k)*PI / ((<span class="keywordtype">double</span>)m2) ));
00151       for (k=0; k&lt;m3 ; ++k) 
00152         plan-&gt;lambda3[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)k)*PI / ((<span class="keywordtype">double</span>)m3) ));
00153       break;
00154     
00155     case DIRICHLET: <span class="comment">/* midpoint symmetry + dirichlet bc forward=dst2, backward=dst3*/</span>
00156       plan-&gt;fftw_normfac = 1.0 / ((<span class="keywordtype">double</span>) (2*m1 * 2*m2 * 2*m3));
00157       plan-&gt;forward  = fftw_plan_r2r_3d(m1,m2,m3, plan-&gt;in, plan-&gt;out, FFTW_RODFT10, FFTW_RODFT10, FFTW_RODFT10, FFTW_ESTIMATE);
00158       plan-&gt;backward = fftw_plan_r2r_3d(m1,m2,m3, plan-&gt;in, plan-&gt;out, FFTW_RODFT01, FFTW_RODFT01, FFTW_RODFT01, FFTW_ESTIMATE);
00159       for (k=0; k&lt;m1 ; ++k) 
00160         plan-&gt;lambda1[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)(k+1))*PI / ((<span class="keywordtype">double</span>)m1) ));
00161       for (k=0; k&lt;m2 ; ++k) 
00162         plan-&gt;lambda2[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)(k+1))*PI / ((<span class="keywordtype">double</span>)m2) ));
00163       for (k=0; k&lt;m3 ; ++k) 
00164         plan-&gt;lambda3[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)(k+1))*PI / ((<span class="keywordtype">double</span>)m3) ));
00165     break;
00166     }
00167 
00168   case GRIDPOINT: switch (bc) {
00169     
00170     <span class="keywordflow">case</span> <a class="code" href="defs_8h.html#a8a4">NEUMANN</a>:<span class="comment">/* gridpoint symmetry + neumann bc forward=backward=dct1*/</span>
00171       plan-&gt;<a class="code" href="structdelta_plan__t.html#o2">fftw_normfac</a> = 1.0 / ((double) (2*(m1-1) * 2*(m2-1) * 2*(m3-1)));
00172       plan-&gt;<a class="code" href="structdelta_plan__t.html#o0">forward</a>  = fftw_plan_r2r_3d(m1,m2,m3, plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>, plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>, FFTW_REDFT00, FFTW_REDFT00, FFTW_REDFT00, FFTW_ESTIMATE);
00173       plan-&gt;<a class="code" href="structdelta_plan__t.html#o1">backward</a> = fftw_plan_r2r_3d(m1,m2,m3, plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>, plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>, FFTW_REDFT00, FFTW_REDFT00, FFTW_REDFT00, FFTW_ESTIMATE);
00174       <span class="keywordflow">for</span> (k=0; k&lt;m1 ; ++k) 
00175         plan-&gt;lambda1[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)k)*PI / ((<span class="keywordtype">double</span>)(m1-1)) ));
00176       for (k=0; k&lt;m2 ; ++k) 
00177         plan-&gt;lambda2[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)k)*PI / ((<span class="keywordtype">double</span>)(m2-1)) ));
00178       for (k=0; k&lt;m3 ; ++k) 
00179         plan-&gt;lambda3[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)k)*PI / ((<span class="keywordtype">double</span>)(m3-1)) ));
00180       break;
00181     
00182     case DIRICHLET:<span class="comment">/* gridpoint symmetry + dirichlet bc forward=backward=dst1*/</span>
00183       plan-&gt;fftw_normfac = 1.0 / ((<span class="keywordtype">double</span>) (2*(m1+1) * 2*(m2+1) * 2*(m3+1)));
00184       plan-&gt;forward  = fftw_plan_r2r_3d(m1,m2,m3, plan-&gt;in, plan-&gt;out, FFTW_RODFT00, FFTW_RODFT00, FFTW_RODFT00, FFTW_ESTIMATE);
00185       plan-&gt;backward = fftw_plan_r2r_3d(m1,m2,m3, plan-&gt;in, plan-&gt;out, FFTW_RODFT00, FFTW_RODFT00, FFTW_RODFT00, FFTW_ESTIMATE );
00186       for (k=0; k&lt;m1 ; ++k) 
00187         plan-&gt;lambda1[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)(k+1))*PI / ((<span class="keywordtype">double</span>)(m1+1)) ));
00188       for (k=0; k&lt;m2 ; ++k) 
00189         plan-&gt;lambda2[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)(k+1))*PI / ((<span class="keywordtype">double</span>)(m2+1)) ));
00190       for (k=0; k&lt;m3 ; ++k) 
00191         plan-&gt;lambda3[k] =  -(2.0 - 2.0*cos( ((<span class="keywordtype">double</span>)(k+1))*PI / ((<span class="keywordtype">double</span>)(m3+1)) ));
00192       break;
00193     };
00194   }
00195   
00196   return plan;
00197 
00198 };
00199 
00200 
00201 <span class="keywordtype">void</span> deleteDeltaPlan(<a class="code" href="structdelta_plan__t.html">deltaPlan</a> plan) {
00202   <span class="keywordflow">if</span> (plan != NULL) {
00203     fftw_destroy_plan(plan-&gt;forward);
00204     fftw_destroy_plan(plan-&gt;backward);
00205     fftw_free(plan-&gt;in);
00206     fftw_free(plan-&gt;out);
00207     fftw_free(plan-&gt;lambda1);
00208     fftw_free(plan-&gt;lambda2);
00209     fftw_free(plan-&gt;lambda3);
00210     free(plan);
00211   }
00212 };
00213 
00214 
00215 
00216 
00217 <span class="comment">/* compute (a*I + b*Delta) in = out */</span>
00218 <span class="keywordtype">void</span> evalDelta(<a class="code" href="structdelta_plan__t.html">deltaPlan</a> plan, 
00219                <span class="keywordtype">double</span> a,
00220                <span class="keywordtype">double</span> b,
00221                <span class="keywordtype">double</span>* in, 
00222                <span class="keywordtype">double</span>* out) {
00223   <span class="keywordtype">int</span> k,k1,k2,k3;
00224   <span class="keywordtype">double</span> lambda;
00225   <span class="keywordflow">for</span> (k=0; k&lt;plan-&gt;m; ++k)
00226     plan-&gt;in[k] = in[k];
00227   
00228   fftw_execute(plan-&gt;forward);
00229 
00230   switch (plan-&gt;dim) {
00231   <span class="keywordflow">case</span> 2:
00232     k = 0;
00233     <span class="keywordflow">for</span> (k1=0; k1&lt;plan-&gt;m1; ++k1) 
00234       for (k2=0; k2&lt;plan-&gt;m2; ++k2) {
00235         lambda = a+b*(plan-&gt;<a class="code" href="structdelta_plan__t.html#o10">h1</a> * plan-&gt;<a class="code" href="structdelta_plan__t.html#o13">lambda1</a>[k1] + 
00236                       plan-&gt;<a class="code" href="structdelta_plan__t.html#o11">h2</a> * plan-&gt;<a class="code" href="structdelta_plan__t.html#o14">lambda2</a>[k2]);
00237         plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>[k] = lambda * plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>[k];
00238         k++;
00239       }
00240     <span class="keywordflow">break</span>;
00241     
00242   <span class="keywordflow">case</span> 3:
00243     k = 0;
00244     <span class="keywordflow">for</span> (k1=0; k1&lt;plan-&gt;m1; ++k1) 
00245       for (k2=0; k2&lt;plan-&gt;m2; ++k2) 
00246         for (k3=0; k3&lt;plan-&gt;m3; ++k3) {
00247           lambda = a+b*(plan-&gt;<a class="code" href="structdelta_plan__t.html#o10">h1</a>*plan-&gt;<a class="code" href="structdelta_plan__t.html#o13">lambda1</a>[k1] + 
00248                         plan-&gt;<a class="code" href="structdelta_plan__t.html#o11">h2</a>*plan-&gt;<a class="code" href="structdelta_plan__t.html#o14">lambda2</a>[k2] + 
00249                         plan-&gt;<a class="code" href="structdelta_plan__t.html#o12">h3</a>*plan-&gt;<a class="code" href="structdelta_plan__t.html#o15">lambda3</a>[k3]);
00250           plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>[k] = lambda * plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>[k];
00251           k++;
00252         }
00253     <span class="keywordflow">break</span>;
00254     
00255   otherwise:
00256     printf(<span class="stringliteral">"%s %d (build %s %s) -- evalDelta\n"</span>);
00257     printf(<span class="stringliteral">"\tCannot handle %d dimensions.\n"</span>);
00258     printf(<span class="stringliteral">"\tExiting on error\n"</span>);
00259     exit(-1);
00260   }
00261   
00262   fftw_execute(plan-&gt;<a class="code" href="structdelta_plan__t.html#o1">backward</a>);
00263   
00264   <span class="keywordflow">for</span> (k=0; k&lt;plan-&gt;m; ++k)
00265     out[k] = plan-&gt;fftw_normfac * plan-&gt;out[k];
00266 }; 
00267 
00268 
00269 
00270 <span class="comment">/* solve (a*I + b*Delta) out = in */</span>
00271 <span class="keywordtype">void</span> solveDelta(<a class="code" href="structdelta_plan__t.html">deltaPlan</a> plan, 
00272                 <span class="keywordtype">double</span> a,
00273                 <span class="keywordtype">double</span> b,
00274                 <span class="keywordtype">double</span>* in, 
00275                 <span class="keywordtype">double</span>* out) {
00276   <span class="keywordtype">int</span> k,k1,k2,k3;
00277   <span class="keywordtype">double</span> lambda;
00278   
00279   <span class="keywordflow">for</span> (k=0; k&lt;plan-&gt;m; ++k)
00280     plan-&gt;in[k] = in[k];
00281   
00282   fftw_execute(plan-&gt;forward);
00283 
00284   switch (plan-&gt;dim) {
00285   <span class="keywordflow">case</span> 2:
00286     k = 0;
00287     <span class="keywordflow">for</span> (k1=0; k1&lt;plan-&gt;m1; ++k1) 
00288       for (k2=0; k2&lt;plan-&gt;m2; ++k2) {
00289         lambda = a+b*(plan-&gt;h1*plan-&gt;lambda1[k1] + 
00290                       plan-&gt;h2*plan-&gt;lambda2[k2]);
00291         plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>[k] = (lambda == 0.0)  ?  0.0  :  1.0/lambda * plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>[k];
00292         k++;
00293       }
00294     <span class="keywordflow">break</span>;
00295     
00296   <span class="keywordflow">case</span> 3:
00297     k = 0;
00298     <span class="keywordflow">for</span> (k1=0; k1&lt;plan-&gt;m1; ++k1) 
00299       for (k2=0; k2&lt;plan-&gt;m2; ++k2) 
00300         for (k3=0; k3&lt;plan-&gt;m3; ++k3) {
00301         lambda = a+b*(plan-&gt;h1*plan-&gt;lambda1[k1] + 
00302                       plan-&gt;h2*plan-&gt;lambda2[k2] +
00303                       plan-&gt;h3*plan-&gt;lambda3[k3]);
00304           plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>[k] = (lambda == 0.0)  ?  0.0  :  1.0/lambda * plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>[k];
00305           k++;
00306         }
00307     <span class="keywordflow">break</span>;
00308     
00309   otherwise:
00310     printf(<span class="stringliteral">"%s %d (build %s %s) -- evalDelta\n"</span>);
00311     printf(<span class="stringliteral">"\tCannot handle %d dimensions.\n"</span>);
00312     printf(<span class="stringliteral">"\tExiting on error\n"</span>);
00313     exit(-1);
00314   }
00315   
00316   fftw_execute(plan-&gt;<a class="code" href="structdelta_plan__t.html#o1">backward</a>);
00317   
00318   <span class="keywordflow">for</span> (k=0; k&lt;plan-&gt;m; ++k)
00319     out[k] = plan-&gt;fftw_normfac * plan-&gt;out[k];
00320 }; 
00321 
00322 
00323 
00324 
00325 
00326 
00327 
00328 
00329 <span class="comment">/* ---------------------------------------- */</span>
00330 <span class="comment">/* ---------------------------------------- */</span>
00331 <span class="comment">/* ---------------------------------------- */</span>
00332 <span class="comment">/* ---------------------------------------- */</span>
00333 <span class="comment">/* ---------------------------------------- */</span>
00334 
00335 <span class="comment">/* compute (a*I + b*Delta^2) in = out */</span>
00336 <span class="keywordtype">void</span> evalCurvature(<a class="code" href="structdelta_plan__t.html">deltaPlan</a> plan, 
00337                <span class="keywordtype">double</span> a,
00338                <span class="keywordtype">double</span> b,
00339                <span class="keywordtype">double</span>* in, 
00340                <span class="keywordtype">double</span>* out) {
00341   <span class="keywordtype">int</span> k,k1,k2,k3;
00342   <span class="keywordtype">double</span> lambda;
00343   
00344   <span class="keywordflow">for</span> (k=0; k&lt;plan-&gt;m; ++k)
00345     plan-&gt;in[k] = in[k];
00346   
00347   fftw_execute(plan-&gt;forward);
00348 
00349   switch (plan-&gt;dim) {
00350   <span class="keywordflow">case</span> 2:
00351     k = 0;
00352     <span class="keywordflow">for</span> (k1=0; k1&lt;plan-&gt;m1; ++k1) 
00353       for (k2=0; k2&lt;plan-&gt;m2; ++k2) {
00354         lambda = a+b*( (plan-&gt;h1*plan-&gt;lambda1[k1] + 
00355                         plan-&gt;h2*plan-&gt;lambda2[k2])
00356                        *
00357                        (plan-&gt;h1*plan-&gt;lambda1[k1] + 
00358                         plan-&gt;h2*plan-&gt;lambda2[k2])  );
00359         plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>[k] = lambda * plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>[k];
00360         k++;
00361       }
00362     <span class="keywordflow">break</span>;
00363     
00364   <span class="keywordflow">case</span> 3:
00365     k = 0;
00366     <span class="keywordflow">for</span> (k1=0; k1&lt;plan-&gt;m1; ++k1) 
00367       for (k2=0; k2&lt;plan-&gt;m2; ++k2) 
00368         for (k3=0; k3&lt;plan-&gt;m3; ++k3) {
00369           lambda = a+b*( (plan-&gt;h1*plan-&gt;lambda1[k1] + 
00370                           plan-&gt;h2*plan-&gt;lambda2[k2] +
00371                           plan-&gt;h3*plan-&gt;lambda3[k3])
00372                          *
00373                          (plan-&gt;h1*plan-&gt;lambda1[k1] + 
00374                           plan-&gt;h2*plan-&gt;lambda2[k2] +
00375                           plan-&gt;h3*plan-&gt;lambda3[k3])  );
00376         plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>[k] = lambda * plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>[k];
00377           k++;
00378         }
00379     <span class="keywordflow">break</span>;
00380     
00381   otherwise:
00382     printf(<span class="stringliteral">"%s %d (build %s %s) -- evalDelta\n"</span>);
00383     printf(<span class="stringliteral">"\tCannot handle %d dimensions.\n"</span>);
00384     printf(<span class="stringliteral">"\tExiting on error\n"</span>);
00385     exit(-1);
00386   }
00387   
00388   fftw_execute(plan-&gt;backward);
00389   
00390   <span class="keywordflow">for</span> (k=0; k&lt;plan-&gt;m; ++k)
00391     out[k] = plan-&gt;fftw_normfac * plan-&gt;out[k];
00392 }; 
00393 
00394 
00395 
00396 <span class="comment">/* solve (a*I + b*Delta^2) out = in */</span>
00397 <span class="keywordtype">void</span> solveCurvature(<a class="code" href="structdelta_plan__t.html">deltaPlan</a> plan, 
00398                     <span class="keywordtype">double</span> a,
00399                     <span class="keywordtype">double</span> b,
00400                     <span class="keywordtype">double</span>* in, 
00401                     <span class="keywordtype">double</span>* out) {
00402   <span class="keywordtype">int</span> k,k1,k2,k3;
00403   <span class="keywordtype">double</span> lambda;
00404   
00405   <span class="keywordflow">for</span> (k=0; k&lt;plan-&gt;m; ++k)
00406     plan-&gt;in[k] = in[k];
00407   
00408   fftw_execute(plan-&gt;forward);
00409 
00410   switch (plan-&gt;dim) {
00411   <span class="keywordflow">case</span> 2:
00412     k = 0;
00413     <span class="keywordflow">for</span> (k1=0; k1&lt;plan-&gt;m1; ++k1) 
00414       for (k2=0; k2&lt;plan-&gt;m2; ++k2) {
00415         lambda = a+b*( (plan-&gt;h1*plan-&gt;lambda1[k1] + 
00416                         plan-&gt;h2*plan-&gt;lambda2[k2])
00417                        *
00418                        (plan-&gt;h1*plan-&gt;lambda1[k1] + 
00419                         plan-&gt;h2*plan-&gt;lambda2[k2])  );
00420         plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>[k] = (lambda == 0.0)  ?  0.0  :  1.0/lambda * plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>[k];
00421         k++;
00422       }
00423     <span class="keywordflow">break</span>;
00424     
00425   <span class="keywordflow">case</span> 3:
00426     k = 0;
00427     <span class="keywordflow">for</span> (k1=0; k1&lt;plan-&gt;m1; ++k1) 
00428       for (k2=0; k2&lt;plan-&gt;m2; ++k2) 
00429         for (k3=0; k3&lt;plan-&gt;m3; ++k3) {
00430           lambda = a+b*( (plan-&gt;h1*plan-&gt;lambda1[k1] + 
00431                           plan-&gt;h2*plan-&gt;lambda2[k2] +
00432                           plan-&gt;h3*plan-&gt;lambda3[k3])
00433                          *
00434                          (plan-&gt;h1*plan-&gt;lambda1[k1] + 
00435                           plan-&gt;h2*plan-&gt;lambda2[k2] +
00436                           plan-&gt;h3*plan-&gt;lambda3[k3])  );
00437           plan-&gt;<a class="code" href="structdelta_plan__t.html#o3">in</a>[k] = (lambda == 0.0)  ?  0.0  :  1.0/lambda * plan-&gt;<a class="code" href="structdelta_plan__t.html#o4">out</a>[k];
00438           k++;
00439         }
00440     <span class="keywordflow">break</span>;
00441     
00442   otherwise:
00443     printf(<span class="stringliteral">"%s %d (build %s %s) -- evalDelta\n"</span>);
00444     printf(<span class="stringliteral">"\tCannot handle %d dimensions.\n"</span>);
00445     printf(<span class="stringliteral">"\tExiting on error\n"</span>);
00446     exit(-1);
00447   }
00448   
00449   fftw_execute(plan-&gt;<a class="code" href="structdelta_plan__t.html#o1">backward</a>);
00450   
00451   <span class="keywordflow">for</span> (k=0; k&lt;plan-&gt;m; ++k)
00452     out[k] = plan-&gt;fftw_normfac * plan-&gt;out[k];
00453 }; 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jan 10 08:16:41 2006 for flirt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
