<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>flirt: diffusive.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">home</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">ens</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">flirtproj</a>&nbsp;/&nbsp;<a class="el" href="dir_000004.html">flirt</a></div>
<h1>diffusive.c</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">// (c) NP, 2005</span>
00002 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00003 <span class="preprocessor">#include "<a class="code" href="diffusive_8h.html">diffusive.h</a>"</span>
00004 
00005 <span class="comment">// alpha = alpha * tau * ( 1 / h);</span>
00006 <span class="keywordtype">void</span> initTriDiagMatrix(size_t m, 
00007                        <span class="keywordtype">double</span> alpha,
00008                        boundary_t bc,
00009                        <a class="code" href="structtri_diag_matrix__t.html">triDiagMatrix</a>* pMatrix)
00010 {
00011         <span class="keywordtype">double</span> factor;
00012         <span class="keywordtype">int</span> j,k;
00013         <a class="code" href="structtri_diag_matrix__t.html">triDiagMatrix</a> M;
00014         M       = (<a class="code" href="structtri_diag_matrix__t.html">triDiagMatrix</a>) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structtri_diag_matrix__t.html">triDiagMatrix_t</a>));
00015         M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a> = (<span class="keywordtype">double</span>*) malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * m);
00016         M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>   = (<span class="keywordtype">double</span>*) malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * (m-1));
00017         M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o1">low</a>  = (<span class="keywordtype">double</span>*) malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * (m-1));
00018         
00019         M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o3">len</a> = m;     
00020         
00021         factor = alpha;
00022         <span class="keywordflow">for</span> (k = 1; k &lt; m; k ++) {
00023                 M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[k] = 1 + 2 * factor;
00024                 M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o1">low</a>[k-1] = (-1.0)*factor;
00025                 M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>[k-1] = (-1.0)*factor;
00026         }
00027         
00028         <span class="keywordflow">if</span> (bc == DIRICHLET) {
00029                 factor = alpha ;
00030                 M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[0] = 1 + 2*factor;
00031                 M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[m-1] = 1 + 2*factor;
00032         }
00033         
00034         <span class="keywordflow">if</span> (bc == NEUMANN) {
00035           factor = alpha;
00036           M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[0] = 1 + factor;
00037           M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[m-1] = 1 + factor;
00038         }
00039 
00040         <span class="comment">// factorize</span>
00041         M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>[0] = M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>[0] / M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[0];
00042         <span class="keywordflow">for</span> (j = 1; j &lt; m-1; j++) { 
00043                 M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[j] = (M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[j] - M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o1">low</a>[j-1] * M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>[j-1]);
00044                 M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>[j] = M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>[j] / M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[j];
00045         }
00046         
00047         M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[m-1] =  (M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[m-1] - M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o1">low</a>[m-2] * M-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>[m-2]);      
00048         
00049         *(pMatrix) = M;
00050 }                     
00051 
00052 <span class="comment">/* --------------------------------------------------------------------- */</span>
00053 
00054 <span class="keywordtype">void</span> initDiffusivePlan2D(size_t m1, 
00055                          size_t m2, 
00056                          <span class="keywordtype">double</span> alpha, 
00057                          <span class="keywordtype">double</span> tau,
00058                          <span class="keywordtype">double</span> h1,
00059                          <span class="keywordtype">double</span> h2,
00060                          boundary_t bc,
00061                          <a class="code" href="structdiffusive_plan__t.html">diffusivePlan</a>* pPlan)
00062 {
00063 
00064   <a class="code" href="structdiffusive_plan__t.html">diffusivePlan</a> M;
00065   M = (<a class="code" href="structdiffusive_plan__t.html">diffusivePlan</a>) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structdiffusive_plan__t.html">diffusivePlan_t</a>));
00066   
00067   initTriDiagMatrix(m1, 2*alpha*tau/h1, bc, &amp;(M-&gt;<a class="code" href="structdiffusive_plan__t.html#o0">M1</a>));
00068   initTriDiagMatrix(m2, 2*alpha*tau/h2, bc, &amp;(M-&gt;<a class="code" href="structdiffusive_plan__t.html#o1">M2</a>));
00069   M-&gt;<a class="code" href="structdiffusive_plan__t.html#o2">M3</a> = NULL;
00070   
00072 <span class="preprocessor">#if 0</span>
00073 <span class="preprocessor"></span>  M-&gt;<a class="code" href="structdiffusive_plan__t.html#o3">tmp</a> = createArray2D(m2,m1);
00074 <span class="preprocessor">#endif</span>
00075 <span class="preprocessor"></span>  M-&gt;<a class="code" href="structdiffusive_plan__t.html#o3">tmp</a> = createTreeStructure2D(m2,m1, (array1D) calloc(m2*m1,<span class="keyword">sizeof</span>(array_t)));
00078   M-&gt;<a class="code" href="structdiffusive_plan__t.html#o4">alpha</a> = alpha;
00079   M-&gt;<a class="code" href="structdiffusive_plan__t.html#o5">tau</a> = tau;
00080   M-&gt;<a class="code" href="structdiffusive_plan__t.html#o6">dim</a> = 2;
00081   M-&gt;<a class="code" href="structdiffusive_plan__t.html#o10">m1</a> = m1;
00082   M-&gt;<a class="code" href="structdiffusive_plan__t.html#o11">m2</a> = m2;
00083   M-&gt;<a class="code" href="structdiffusive_plan__t.html#o12">m3</a> = 1;
00084   M-&gt;<a class="code" href="structdiffusive_plan__t.html#o7">h1</a> = h1;
00085   M-&gt;<a class="code" href="structdiffusive_plan__t.html#o8">h2</a> = h2;
00086   M-&gt;<a class="code" href="structdiffusive_plan__t.html#o9">h3</a> = 0;
00087 
00088   <span class="comment">/* printf("%s %d (Build %s %s) -- \n"</span>
00089 <span class="comment">     ,__FILE__,__LINE__,__DATE__,__TIME__); */</span>
00090   <span class="comment">/*   printDiffusivePlan(M);   */</span>
00091 
00092   *(pPlan) = M;
00093 }                          
00094 
00095 <span class="comment">/* --------------------------------------------------------------------- */</span>
00096 
00097 <span class="keywordtype">void</span> solveThomas(<a class="code" href="structtri_diag_matrix__t.html">triDiagMatrix</a> A,
00098                  <span class="keywordtype">double</span>* b, 
00099                  <span class="keywordtype">int</span> inc, 
00100                  <span class="keywordtype">double</span>* x)
00101 {
00102   <span class="keywordtype">int</span> j,k;
00103   <span class="comment">/* Kopieren der rechten Seite nach x */</span>
00104   <span class="comment">/* und Vorwaertseinsetzen */</span>
00105   
00106   x[0] = b[0] / A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[0];
00107   <span class="keywordflow">for</span> (j = inc,k=1; k &lt; A-&gt;len; j += inc, k++) {
00108     x[j] = (b[j] - A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o1">low</a>[k-1]*x[j-inc]) / A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[k];
00109   }
00110   
00111   <span class="comment">/* Rueckwaertseinsetzen */</span>    
00112   <span class="keywordflow">for</span> (j = (A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o3">len</a>-2)*inc, k=A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o3">len</a>-2; k &gt; -1; j-=inc, k--) {
00113     x[j] = x[j] - A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>[k] * x[j+inc];
00114   }
00115 }       
00116 
00117 <span class="comment">/* --------------------------------------------------------------------- */</span>
00118 
00119 <span class="keywordtype">void</span> printDiffusivePlan(<span class="keyword">const</span> <a class="code" href="structdiffusive_plan__t.html">diffusivePlan</a> M) {
00120   printf(<span class="stringliteral">"-- diffusivePlan at %p\n"</span>,M);
00121   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"M-&gt;M1"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o0">M1</a>);
00122   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"M-&gt;M2"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o1">M2</a>);
00123   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"M-&gt;M3"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o2">M3</a>);
00124   printf(<span class="stringliteral">"%30s : %p\n"</span>,<span class="stringliteral">"M-&gt;tmp"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o3">tmp</a>);
00125   printf(<span class="stringliteral">"%30s : %g\n"</span>,<span class="stringliteral">"M-&gt;alpha"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o4">alpha</a>);
00126   printf(<span class="stringliteral">"%30s : %g\n"</span>,<span class="stringliteral">"M-&gt;tau"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o5">tau</a>);
00127   printf(<span class="stringliteral">"%30s : %d\n"</span>,<span class="stringliteral">"M-&gt;dim"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o6">dim</a>);
00128   printf(<span class="stringliteral">"%30s : %g\n"</span>,<span class="stringliteral">"M-&gt;h1"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o7">h1</a>);
00129   printf(<span class="stringliteral">"%30s : %g\n"</span>,<span class="stringliteral">"M-&gt;h2"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o8">h2</a>);
00130   printf(<span class="stringliteral">"%30s : %g\n"</span>,<span class="stringliteral">"M-&gt;h3"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o9">h3</a>);
00131   printf(<span class="stringliteral">"%30s : %d\n"</span>,<span class="stringliteral">"M-&gt;m1"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o10">m1</a>);
00132   printf(<span class="stringliteral">"%30s : %d\n"</span>,<span class="stringliteral">"M-&gt;m2"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o11">m2</a>);
00133   printf(<span class="stringliteral">"%30s : %d\n"</span>,<span class="stringliteral">"M-&gt;m3"</span>,M-&gt;<a class="code" href="structdiffusive_plan__t.html#o12">m3</a>);
00134 };
00135 <span class="comment">/* ---------------------------------------------------------------------- */</span>
00136 
00137 <span class="keywordtype">void</span> printTriDiagMatrix(<span class="keyword">const</span> <a class="code" href="structtri_diag_matrix__t.html">triDiagMatrix</a> A) 
00138 {
00139         <span class="keywordtype">int</span> k1,k2;
00140         printf(<span class="stringliteral">"printTriDiagMatrix \n"</span>);
00141         <span class="keywordflow">for</span> (k1 = 0; k1 &lt; A-&gt;len - 1; k1++) {
00142                                 <span class="keywordflow">if</span> (k1 == 0) 
00143                                 {
00144                                         printf(<span class="stringliteral">"%g\t%g\n"</span>,A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>[k1],A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>[k1]); 
00145                                 }       
00146                                 <span class="keywordflow">else</span> 
00147                                 {       
00148                                         <span class="keywordflow">for</span> (k2 = 0; k2 &lt; k1-1; k2++) printf("\t");
00149                                         printf("%g\t%g\t%g\n",A-&gt;low[k1-1],A-&gt;diag[k1],A-&gt;up[k1]);
00150                                 }
00151                 }
00152         for (k2 = 0; k2 &lt; k1-1; k2++) printf("\t");
00153         printf("%g\t%g\n\n",A-&gt;low[k1-1],A-&gt;diag[k1]);
00154 
00155                                 
00156 }
00157 
00158 <span class="comment">/* ---------------------------------------------------------------------- */</span>
00159 
00160 <span class="keywordtype">void</span> solveDiffusive2D(<a class="code" href="structdiffusive_plan__t.html">diffusivePlan</a> M, 
00161                       <span class="keywordtype">double</span>** b, 
00162                       <span class="keywordtype">double</span>** x)
00163 {
00164   <span class="keywordtype">int</span> j1, j2;   
00165 
00166   <span class="keywordflow">for</span> (j2 = 0; j2 &lt; M-&gt;m2; j2++) {
00167     solveThomas(M-&gt;M1,b[j2],1,(<span class="keywordtype">double</span>*)(M-&gt;tmp[j2]));
00168   }
00169   
00170 
00171   <span class="keywordflow">for</span> (j1 = 0; j1 &lt; M-&gt;m1; j1++) {
00172         solveThomas(M-&gt;M2,b[0]+j1,M-&gt;m1, x[0]+j1);
00173   }     
00174 
00175   <span class="comment">/*</span>
00176 <span class="comment">  printf("\n");</span>
00177 <span class="comment">  printToFileArray2D(M-&gt;tmp,M-&gt;m2,M-&gt;m1, stdout);</span>
00178 <span class="comment">  printf("\n");</span>
00179 <span class="comment">  printToFileArray2D(x,M-&gt;m2,M-&gt;m1, stdout);</span>
00180 <span class="comment">  */</span>
00181   <span class="comment">/* Averaging results */</span>
00182   mult(0.5, M-&gt;tmp[0],M-&gt;tmp[0], M-&gt;m1 * M-&gt;m2);
00183   mult(0.5, x[0], x[0], M-&gt;m1 * M-&gt;m2);
00184   
00185   add(M-&gt;tmp[0], x[0], x[0], M-&gt;m1 * M-&gt;m2);
00186 }
00187 
00188     <span class="comment">/* --------------------------------------------------------------------- */</span>
00189 <span class="keywordtype">void</span> deleteTriDiagMatrix(<a class="code" href="structtri_diag_matrix__t.html">triDiagMatrix</a> A)
00190 {
00191     free(A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o0">diag</a>);
00192     free(A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o1">low</a>);
00193     free(A-&gt;<a class="code" href="structtri_diag_matrix__t.html#o2">up</a>);
00194     free(A);
00195 }
00196 <span class="comment">/* --------------------------------------------------------------------- */</span>
00197 <span class="keywordtype">void</span> deleteDiffusivePlan(<a class="code" href="structdiffusive_plan__t.html">diffusivePlan</a> M)
00198 {
00199     <span class="keywordflow">if</span> (M-&gt;<a class="code" href="structdiffusive_plan__t.html#o6">dim</a> == 2) {
00200         deleteTriDiagMatrix(M-&gt;<a class="code" href="structdiffusive_plan__t.html#o0">M1</a>);
00201         deleteTriDiagMatrix(M-&gt;<a class="code" href="structdiffusive_plan__t.html#o1">M2</a>);
00202     }
00203     deleteArray2D(M-&gt;<a class="code" href="structdiffusive_plan__t.html#o3">tmp</a>);
00204     free(M);
00205 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jan 10 08:16:41 2006 for flirt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
