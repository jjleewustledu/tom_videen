<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>flirt: main.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">home</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">ens</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">flirtproj</a>&nbsp;/&nbsp;<a class="el" href="dir_000003.html">flirt++</a></div>
<h1>main.cc</h1><a href="main_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include "flirt++.h"</span>
00002 
00003 <span class="keyword">using</span> <span class="keyword">namespace </span>flirt;
00004 
00005 
00006 <span class="keyword">typedef</span> <span class="keyword">enum</span> {
00007   DIFFUSIVE_AOS,
00008   DIFFUSIVE_FFT,
00009   CURVATURE_FFT,
00010   ELASIC_FFT
00011 } smoother_t;
00012 
00013 smoother_t getSolverType(<span class="keyword">const</span> <span class="keywordtype">char</span>* str) {
00014   <span class="keywordflow">if</span> (strcasecmp(str,<span class="stringliteral">"DIFFUSIVE_AOS"</span>)==0) return DIFFUSIVE_AOS;
00015   if (strcasecmp(str,"DIFFUSIVE_FFT")==0) return DIFFUSIVE_FFT;
00016   if (strcasecmp(str,"CURVATURE_FFT")==0) return CURVATURE_FFT;
00017   <span class="comment">//if (strcmp(str,"ELASTIC_FFT")  ==0) return ELASTIC_FFT;</span>
00018   
00019   printf("Unkown smoother requsted (\"%s\").\n"
00020          "Using CURVATURE_FFT as default.\n",str);
00021   return CURVATURE_FFT;
00022 };
00023 
00024 
00025 
<a name="l00029"></a><a class="code" href="main_8cc.html#a5">00029</a> <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {
00030   printf(<span class="stringliteral">"\n--------------- start FLIRT --------------- \n\n"</span>);
00034   <span class="keywordtype">int</span> m1, m2;
00035   <span class="keywordtype">double</span> h1 = 1.0, h2 = 1.0;
00036   <span class="keywordtype">char</span> *fileNameT    = (<span class="keywordtype">char</span>*)malloc(255*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00037   <span class="keywordtype">char</span> *fileNameR    = (<span class="keywordtype">char</span>*)malloc(255*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00038   <span class="keywordtype">char</span> *fileNameOut  = (<span class="keywordtype">char</span>*)malloc(255*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00039   <span class="keywordtype">char</span> *smootherName = (<span class="keywordtype">char</span>*)malloc(255*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00040   <span class="keywordtype">int</span> maxIter = 10;
00041   <span class="keywordtype">double</span> alpha = 1.0;
00042   <span class="keywordtype">double</span> tau = 1.0;
00043   <span class="keywordtype">double</span> mu = 0.0;
00044   <span class="keywordtype">double</span> lambda = 0.0;
00045   
00046   <span class="keywordflow">if</span> (argc &gt; 1)
00047     getMainParameters(argv[1],
00048                       &amp;m1,&amp;m2,
00049                       &amp;h1,&amp;h2,
00050                       fileNameT,fileNameR,fileNameOut,
00051                       smootherName,
00052                       &amp;maxIter,
00053                       &amp;alpha,&amp;tau,
00054                       &amp;mu, &amp;lambda);
00055   <span class="keywordflow">else</span>{
00056     printf(<span class="stringliteral">"ERROR: no parameter-file-name given, abort\n\n"</span>);
00057     <span class="keywordflow">return</span> 0;
00058   }
00059   
00060 
00061   
00062   <a class="code" href="classflirt_1_1_image2_d.html">Image2D</a> R( fileNameR, h1, h2);
00063 
00064   <a class="code" href="classflirt_1_1_transformable_image2_d.html">TransformableImage2D</a> T( fileNameT, h1, h2); 
00065 
00066   <a class="code" href="classflirt_1_1_displacement2_d.html">Displacement2D</a> u( R.<a class="code" href="classflirt_1_1_array.html#a12">getDimensions</a>(), h1, h2);
00067  
00068   SumOfSquaredDifferences distancemeasure( R, T);       
00069  
00070   <a class="code" href="classflirt_1_1_diffusive_smoother.html">DiffusiveSmoother</a> smoother;
00071 
00072   <a class="code" href="classflirt_1_1_t_m_solver.html">TMSolver</a>* solver;
00073   
00074   <span class="keywordflow">switch</span> (getSolverType(smootherName)) {
00075   <span class="keywordflow">case</span> DIFFUSIVE_AOS: 
00076     solver = <span class="keyword">new</span> <a class="code" href="classflirt_1_1_t_m_solver_diffusive_a_o_s2_d.html">TMSolverDiffusiveAOS2D</a>;
00077     <span class="keywordflow">break</span>;
00078     
00079   <span class="keywordflow">case</span> DIFFUSIVE_FFT: 
00080     solver = <span class="keyword">new</span> <a class="code" href="classflirt_1_1_t_m_solver_diffusive_f_f_t2_d.html">TMSolverDiffusiveFFT2D</a>;
00081     <span class="keywordflow">break</span>;
00082     
00083   <span class="keywordflow">default</span>: 
00084     solver = <span class="keyword">new</span> <a class="code" href="classflirt_1_1_t_m_solver_curvature_f_f_t2_d.html">TMSolverCurvatureFFT2D</a>;
00085   };
00086 
00087   <a class="code" href="classflirt_1_1_f_p_solver_curvature_f_f_t2_d.html">FPSolverCurvatureFFT2D</a> fpsolver( u, alpha);
00088   
00089   <a class="code" href="classflirt_1_1_f_p_optimizer.html">FPOptimizer</a> opti( distancemeasure, smoother, fpsolver, alpha);
00090 
00091   <span class="comment">//TMOptimizer opti(distancemeasure,smoother,*solver);</span>
00092   <span class="comment">//opti.setParams(alpha,tau);</span>
00093   
00094   <span class="comment">//UpdateRule ur(distancemeasure,smoother,opti);</span>
00095   <a class="code" href="classflirt_1_1_line_search.html">LineSearch</a> ur( distancemeasure, smoother, opti, T, u);
00096 
00097   <a class="code" href="classflirt_1_1_stop_rule.html">StopRule</a>  sr( distancemeasure, smoother, maxIter);
00098   
00099   <span class="keywordtype">int</span> iter = 0;
00100 
00101   printf(<span class="stringliteral">"%3s | %15s\n"</span>,<span class="stringliteral">"n"</span>,<span class="stringliteral">"D[u]"</span>);
00102   printf(<span class="stringliteral">"%3s-+-%15s\n"</span>,<span class="stringliteral">"---"</span>,<span class="stringliteral">"---------------"</span>);
00103 
00104         
00106   T.<a class="code" href="classflirt_1_1_transformable_image2_d.html#a8">transform</a>(u);
00107   distancemeasure.eval();
00108   distancemeasure.evalGradient();
00109   smoother.<a class="code" href="classflirt_1_1_diffusive_smoother.html#a2">eval</a>(u);
00110   smoother.<a class="code" href="classflirt_1_1_diffusive_smoother.html#a3">evalGradient</a>(u);
00111 
00112   printf(<span class="stringliteral">"%3d | %15.5e\n"</span>,iter,distancemeasure.getValue());
00113   
00114   <span class="keywordflow">do</span> {
00115     <span class="comment">//add(u.getData(),uConst.getData(),u.getData(),u.getNumberOfElements());</span>
00116 
00117     iter++;
00118     
00119     opti.<a class="code" href="classflirt_1_1_f_p_optimizer.html#a3">computeDisplacementUpdate</a>( u);
00120    
00121     ur.<a class="code" href="classflirt_1_1_line_search.html#a1">updateDisplacement</a>(u);
00123     T.<a class="code" href="classflirt_1_1_transformable_image2_d.html#a8">transform</a>(u);
00124 
00125     distancemeasure.eval();
00126 
00127     distancemeasure.evalGradient();
00128 
00129     smoother.<a class="code" href="classflirt_1_1_diffusive_smoother.html#a2">eval</a>(u);
00130 
00131     smoother.<a class="code" href="classflirt_1_1_diffusive_smoother.html#a3">evalGradient</a>(u);
00132 
00133                 
00134     <span class="comment">//definierter Zustand: Alle Groessen uptodate </span>
00135     <span class="comment">//  ( T(u), D(u), S(u), gradD(u), gradS(u)) </span>
00136         printf(<span class="stringliteral">"%3d | %15.5e\n"</span>,iter,distancemeasure.getValue());
00137     
00138   }
00139   <span class="keywordflow">while</span> (!sr.<a class="code" href="classflirt_1_1_stop_rule.html#a2">stopIteration</a>(u, iter));
00140 
00141   T.<a class="code" href="classflirt_1_1_transformable_image2_d.html#a11">writeTransformedImageToTiff</a>(fileNameOut);
00142   printf(<span class="stringliteral">"\b\b \n"</span>);
00143         
00144   printf(<span class="stringliteral">"\n--------------- quit FLIRT ---------------\n\n"</span>);
00145   <span class="keywordflow">return</span> 1;
00146 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jan 10 08:16:41 2006 for flirt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
