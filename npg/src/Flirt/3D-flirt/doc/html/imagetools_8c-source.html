<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>flirt: imagetools.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">home</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">ens</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">flirtproj</a>&nbsp;/&nbsp;<a class="el" href="dir_000004.html">flirt</a></div>
<h1>imagetools.c</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#include "<a class="code" href="imagetools_8h.html">imagetools.h</a>"</span>
00002 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00003 <span class="preprocessor">#include &lt;math.h&gt;</span>
00004 
00005 <span class="comment">/*</span>
00006 <span class="comment"> Compute gradient of T using central finite differences; at the boundarys</span>
00007 <span class="comment"> DIRICHLET or NEUMANN are used,  </span>
00008 <span class="comment">    d1T[j1][j2] = 1/2* ( T[j1+1][j2] - T[j1-1][j2])</span>
00009 <span class="comment">    d2T[j1][j2] = 1/2* ( T[j1][j2+1] - T[j1][j2-1])</span>
00010 <span class="comment">*/</span>
00011 <span class="keywordtype">void</span> computeFDGrad2D(array2D T, 
00012                                          size_t m1, 
00013                                          size_t m2,
00014                      <span class="keywordtype">double</span> h1,
00015                      <span class="keywordtype">double</span> h2,
00016                                          boundary_t bc,
00017                                          array3D dT)
00018 {
00019   <span class="keywordtype">int</span>  j1, j2;
00020   <span class="keywordtype">double</span> fac;
00021   
00022   <span class="comment">/* compute Tner gradient without respect to BC */</span>
00023         
00024   <span class="comment">/* Gradient T x1 */</span>
00025   fac = 1 / (2*h1);
00026   <span class="keywordflow">for</span> (j1= 1; j1 &lt; (m1-1); j1 ++) {
00027       <span class="keywordflow">for</span> (j2 = 0; j2 &lt; m2; j2 ++) {
00028           dT[0][j1][j2] = fac * (T[j1 + 1][j2] - T[j1 - 1][j2]);
00029       }
00030   }
00031   <span class="comment">/* Gradient T x2 */</span>
00032   fac = 1 / (2*h2);
00033   <span class="keywordflow">for</span> (j1 = 0; j1 &lt; m1 ; j1 ++) {
00034       <span class="keywordflow">for</span> (j2 = 1; j2 &lt; (m2-1); j2 ++) {
00035           dT[1][j1][j2] = fac * (T[j1][j2 + 1] - T[j1][j2 - 1]);
00036       }
00037   }
00038   <span class="comment">/* compute gradient on image boundarys with respect to BC */</span>
00039   <span class="keywordflow">switch</span> (bc)
00040   {
00041       <span class="keywordflow">case</span> <a class="code" href="defs_8h.html#a8a4">NEUMANN</a>:    <span class="comment">/* Neumann 0 BC */</span>
00042       {
00043           <span class="comment">/* T x1 Direction */</span>
00044           fac = 1 / (2*h1);
00045           <span class="keywordflow">for</span> (j2 = 0; j2 &lt; m2; j2 ++) {
00046               dT[0][0][j2] = fac * (T[1][j2] - T[0][j2]);
00047               dT[0][m1-1][j2] = fac * (T[m1-1][j2] - T[m1-2][j2]);
00048           }
00049           <span class="comment">/* T x2 Direction */</span>
00050           fac = 1 / (2*h2);
00051           <span class="keywordflow">for</span> (j1 = 0; j1 &lt; m1; j1 ++) {
00052               dT[1][j1][0] = fac * (T[j1][1] - T[j1][0]);
00053               dT[1][j1][m2-1] = fac * (T[j1][m2-1] - T[j1][m2-2]);
00054           }
00055 
00056           <span class="keywordflow">break</span>;
00057       }<span class="comment">/* end of case NEUMANN */</span>
00058 
00059     <span class="keywordflow">case</span> <a class="code" href="defs_8h.html#a8a3">DIRICHLET</a>:    <span class="comment">/* Dirichlet 0 BC */</span>
00060     {
00061         <span class="comment">/* T x1 Direction */</span>
00062         fac = 1 / (h1);
00063         <span class="keywordflow">for</span> (j2 = 0; j2 &lt; m2; j2 ++)
00064         {
00065             dT[0][0][j2] = fac * (T[1][j2]);
00066             dT[0][m1-1][j2] = fac * (- T[m1-2][j2]);
00067         }
00068 
00069         <span class="comment">/* T x2 Direction */</span>
00070         fac = 1 / (h2);
00071         <span class="keywordflow">for</span> (j1 = 0; j1 &lt; m1; j1 ++)
00072         {
00073             dT[1][j1][0] = fac * (T[j1][1]);
00074             dT[1][j1][m1-1] = fac * (- T[j1][m2-2]);
00075         }
00076 
00077         <span class="keywordflow">break</span>;
00078     }<span class="comment">/* end of case DIRICHLET*/</span>
00079                 
00080  <span class="keywordflow">default</span>: {}
00081 
00082   }<span class="comment">/* end of switch bc */</span>
00083   <span class="comment">/* printf("\nend\n"); */</span>
00084 };<span class="comment">/* end of computeFDGrad2D() */</span>
00085 
00086 
00087 <span class="keywordtype">void</span> evalDisplacementLinear2D(array2D T, 
00088                               size_t m1, 
00089                               size_t m2, 
00090                               array2D U1, 
00091                               array2D U2,
00092                               array2D Tphi) {
00093   
00094      <span class="keywordtype">int</span> j1,j2, k, i1, i2, index;
00095      
00096      <span class="keywordtype">int</span> I1[2];
00097      <span class="keywordtype">int</span> I2[2];
00098      <span class="keywordtype">double</span> w1[2];
00099      <span class="keywordtype">double</span> w2[2];
00100      <span class="keywordtype">double</span> X,Y;
00101       
00102      <span class="keywordflow">for</span> (j1 = 0; j1 &lt; m1; j1++) {
00103        <span class="keywordflow">for</span> (j2 = 0; j2 &lt; m2; j2++) {
00104          X = j1 + U1[j1][j2];
00105          Y = j2 + U2[j1][j2];
00106          
00107          w1[1] = X - floor(X);
00108          w1[0] = 1.0 - w1[1];
00109          
00110          w2[1] = Y - floor(Y);
00111          w2[0] = 1.0 - w2[1];
00112     
00113          
00114          
00115          index =  (int) floor(X);
00116          <span class="keywordflow">for</span> (k=0; k&lt;2; ++k) {
00117            <span class="keywordflow">if</span> ( (index &lt; 0) || ( index &gt; (m1-1)) ) {
00118              I1[k] = 0; 
00119              w1[k] = 0.0;
00120            } <span class="keywordflow">else</span> {
00121              I1[k] = index;       
00122            };
00123            index++;
00124          };
00125          
00126          index =  (int) floor(Y);
00127          <span class="keywordflow">for</span> (k=0; k&lt;2; ++k) {
00128            <span class="keywordflow">if</span> ( (index &lt; 0) || ( index &gt; (m2-1)) ) {
00129              I2[k] = 0; 
00130              w2[k] = 0.0;
00131            } <span class="keywordflow">else</span> {
00132              I2[k] = index;       
00133            };
00134            index++;
00135          };
00136          
00137          Tphi[j1][j2] = 0.0;
00138          <span class="keywordflow">for</span> (i1=0; i1&lt;2; ++i1)
00139            for (i2=0; i2&lt;2; ++i2)
00140              Tphi[j1][j2] += w1[i1]*w2[i2]* T[I1[i1]][I2[i2]];
00141          
00142        }
00143      }
00144 }<span class="comment">/* end of evalDisplacementLinear2D() */</span>
00145 
00146 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jan 10 08:16:41 2006 for flirt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
