head	2.0;
access;
symbols;
locks; strict;
comment	@c @;


2.0
date	2004.02.20.14.34.10;	author tom;	state Exp;
branches;
next	1.6;

1.6
date	2002.12.02.21.26.52;	author tom;	state Exp;
branches;
next	1.5;

1.5
date	2001.06.01.15.40.17;	author tom;	state Exp;
branches;
next	1.4;

1.4
date	2001.05.30.20.01.40;	author tom;	state Exp;
branches;
next	1.3;

1.3
date	2001.05.30.19.46.30;	author tom;	state Exp;
branches;
next	1.2;

1.2
date	99.12.15.21.33.36;	author tom;	state Exp;
branches;
next	1.1;

1.1
date	99.12.14.16.12.02;	author tom;	state Exp;
branches;
next	;


desc
@rename from main
@


2.0
log
@Feb 2004
@
text
@C     $Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.6 2002/12/02 21:26:52 tom Exp tom $
C     $Log: spideram.f,v $
c Revision 1.6  2002/12/02  21:26:52  tom
c format changes plus fixes for g77
c
c     Revision 1.5  2001/06/01  15:40:17  tom
c     fix d2oxygen.f
c     
c     Revision 1.4  2001/05/30  20:01:40  tom
c     version expanded to 11 chars
c     
c     Revision 1.3  2001/05/30  19:46:30  tom
c     add steady-state oxygen processing
c     
c     Revision 1.2  1999/12/15  21:33:36  tom
c     y2k fix
c     
c     Revision 1.1  1999/12/14  16:12:02  tom
c     Initial revision
c     
c     Revision 1.65  1999/08/09  14:04:36  tom
c     increase BOUNDARY from 2000 -> 20000 points
c     
c     Revision 1.64  1999/03/05  18:49:14  tom
c     add CVO2
c     
c     Revision 1.63  1999/02/17  18:43:30  tom
c     add 8x6 and 3x2 displays for PC uinsg 1024x768 screen resolution
c     
c     Revision 1.62  1998/04/29  15:20:35  tom
c     allow processing for CMRGlucose
c     
c     Revision 1.61  1997/10/24  21:52:34  tom
c     add NOZEROS option to g2wholes.f and m2global.f
c     
c     Revision 1.60  1997/10/16  18:26:56  tom
c     modified r2save for handling CT images
c     
c     Revision 1.59  1997/06/04  19:15:38  tom
c     add fill option 'Q' to m2region
c     change LEN in p2point
c     
c     Revision 1.58  1996/10/23  21:48:21  tom
c     modify r2get, r2save, m2region for EXACT HR scanner
c     
c     Revision 1.57  1996/10/16  17:01:57  tom
c     new libimage
c     
c     Revision 1.56  1996/09/26  17:57:40  tom
c     Solaris
c     
c     Revision 1.55  1996/08/05  14:29:56  tom
c     new libimage and getimage.c
c     
c     Revision 1.54  1996/05/21  21:45:02  tom
c     revised getimage.c to divide by decay_corr_fctr for matrix 7.0 files
c     and to use 10000 as scaler when units are 1/cm
c     
c     Revision 1.53  1996/04/19  19:58:32  tom
c     changed version date
c     
c     Revision 1.52  1996/02/19  22:51:50  tom
c     change getimage.c to display 961 transmission images
c     
c     Revision 1.51  1995/12/20  16:43:52  tom
c     new libimg.a
c     
c     Revision 1.50  1995/12/19  14:34:46  tom
c     revised getimage.c
c     
c     Revision 1.49  1995/12/12  20:41:49  tom
c     original for version 7
c     
c     Revision 1.48  1995/11/10  16:39:08  tom
c     update with new libnpg to read 961 images
c     
c     Revision 1.47  1995/10/31  19:07:39  tom
c     changed Version date
c     
c     Revision 1.46  1994/11/29  23:33:24  ty7777
c     Changed the date.
c     
c     Revision 1.45  1994/11/29  23:09:32  ty7777
c     Use initial slice and number of slices for GBA.
c     
c     Revision 1.44  1994/08/16  16:37:01  tom
c     Modified a2save.f to use lowercase "rgt" and to close file after write.
c     
c     Revision 1.43  1994/06/17  21:30:56  ty7777
c     Added message for PC display.
c     
c     Revision 1.42  1994/06/17  21:17:46  ty7777
c     Change the date format for pc screen.
c     
c     Revision 1.41  1994/06/16  21:00:59  ty7777
c     The current version works on both the Workstation and the PCs.
c     
c     Revision 1.40  1994/06/14  15:57:23  ty7777
c     Move down the save window dump menu.
c     
c     Revision 1.39  1994/06/10  15:06:46  ty7777
c     Use the PCFLAG in ramimg ().
c     
c     Revision 1.38  1994/06/06  17:56:35  ty7777
c     Correct the date.
c     
c     Revision 1.37  1994/06/06  17:07:54  ty7777
c     Update the date.
c     
c     Revision 1.36  1994/06/06  17:00:49  ty7777
c     Added arguments for ramini ().
c     
c     Revision 1.35  1994/05/25  20:17:47  ty7777
c     Modified to read reg files generated from locate.
c     
c     Revision 1.34  1994/05/02  16:40:18  ty7777
c     Added initialization for the zorigin.
c     
c     Revision 1.33  1994/02/08  20:32:56  ty7777
c     Fixing the color bar display problem in half brain.
c     
c     Revision 1.32  1994/01/27  16:10:44  ty7777
c     Changed the Unix path input place.
c     
c     Revision 1.31  1994/01/21  18:40:37  ty7777
c     Added copyright.
c     
c     Revision 1.30  1994/01/21  18:20:15  ty7777
c     Added the copyright message.
c     
c     Revision 1.29  1994/01/14  19:22:22  ty7777
c     Added processing for images with more than 49 slices.
c     
c     Revision 1.28  1994/01/07  20:50:26  ty7777
c     Change the date.
c     
c     Revision 1.27  1994/01/07  20:49:30  ty7777
c     Adding template for images with more than 49 slices.
c     
c     Revision 1.26  1993/11/24  20:31:25  ty7777
c     RAMINI is changed.
c     
c     Revision 1.25  1993/11/24  17:30:54  ty7777
c     Added RMFILE to XRAMEXIT.
c     
c     Revision 1.24  1993/11/18  20:11:57  ty7777
c     Changed region extension.
c     
c     Revision 1.23  1993/11/18  20:04:30  ty7777
c     libpe.a is changed to process the ButtonRelease signal.
c     
c     Revision 1.22  1993/10/05  21:20:50  tom
c     new version for x-reversed ecat images
c     
c     Revision 1.21  1993/10/04  21:55:32  tom
c     added ability to display ntype = 11 or 12 (oef and cmro2 from t88mean)
c     
c     Revision 1.20  1993/07/14  18:50:40  ty7777
c     Rebuilt with new libraries libpetutil.a. Use default ecat_calibration_fctr
c     if the one in the image_subheader is 0.
c     
c     Revision 1.19  1993/07/12  21:20:26  tom
c     Rebuilt with new libpetutil:
c     pixel value = pixel * quant_factor * frame_duration * ecat_calibration_fctr
c     
c     Revision 1.18  1993/03/04  16:30:25  ty7777
c     Before moving to HP machines.
c     
c     Revision 1.17  1992/12/08  21:10:12  ty7777
c     Before calling libcti library.
c     
c     Revision 1.16  1992/10/21  16:14:22  ty7777
c     Changed scaling factor of ECAT images to 1.0.
c     
c     Revision 1.15  1992/10/13  19:47:34  ty7777
c     Replace CTOI with NEWCTOI.
c     
c     Revision 1.14  1992/10/08  15:49:24  ty7777
c     Before libpetutil library changed.
c     
c     Revision 1.13  1992/08/21  20:15:51  ty7777
c     Testing RCS checking in.
c     
c     Revision 1.12  1992/08/21  20:11:10  ty7777
c     After fixing ECAT number of slices bug.
c     
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     
C     Program:      spideram.f
C     Author:       Tom O. Videen
C     Date:         12-Jun-87
C     Written For:  Super PETT II Image Display Program
C     Intent:
C     .  This is an interactive program for displaying PET images,
C     .  defining regions on them, and performing statistical
C     .  calculations on defined regions.
C     .  This program presents the main menu and call subroutines to
C     .  execute the option selected.
C     
C     The program is called through SPIDERAM.CSS
C     
C     History:
C     .  Modified 09-Aug-99 by TOV to allow increase irreg reg points 2000->20000
C     .  Modified 05-Mar-99 by TOV to allow processing for CVO2
C     .    (PROCESS may be 0-7)
C     .    (altered:  main d2barlab d2bartwo d2option d2prcimg d2oxygen
C     .    g2meanrg g2wholes m2analyz m2displa m2global a2print)
C     .  Modified 29-Apr-98 by TOV to allow processing for CMRGlucose:
C     .    (PROCESS may be 0-6)
C     .    (altered:  main d2barlab d2bartwo d2option d2prcimg d2proces
C     .    g2meanrg g2wholes m2analyz m2displa m2global)
C     .  Modified by TOV 16-Jul-87:
C     .  1) change record length of .REG file from 256 to 80;
C     .  2) color scaling ranges from 0-240 for normal images
C     .    (instead of 0-256) and from 320-480 for relative images
C     .    (instead of 300-500); COLOR40 and 41 are default tables;
C     .  3) correct bug in scaling quarter screen images to individual max;
C     .    Modified by TOV 12-Aug-87:
C     .  1) allow GETIMAGE to read write-protected files by avoiding
C     .    a compiler bug for INQUIRE statements;
C     .  2) eliminate a bug in error checking for max. number of sections
C     .    to display for coronal and sagittal sections;
C     .  Modified by TOV 21-Aug-87:
C     .  1) M2FILES delete option reinitializes PETTNUM and NMSLICES
C     .    iff there are no files remaining in the list;
C     .  2) Add a fast file entry option in SPIDERAM (subroutine M2FASTF);
C     .  Modified by TOV 26-Aug-87:
C     .  1) eliminate a bug in right/left hemisphere values in G2WHOLES;
C     .  2) allow selection of a different midline value in M2GLOBAL
C     .    without returning to the regions menu;
C     .  Modified by TOV 03-Sep-87:
C     .  1) correct a bug in A2SAVE in write format for RGT files;
C     .    Note: Dan Schuster wants an RGT file with 80 columns which
C     .    requires a modification of A2SAVE.
C     .  Modified 11-Sep-87 by TOV to add messages for overriding
C     .    non-blank file extensions in M2FASTF.
C     .  Modified 15-Sep-87 by TOV to correct a minor bug in the
C     .    displayed menu in A2ANALYZ.
C     .  Modified 02-Oct-87 by TOV to set SCALER for tissue activity
C     .    processing to 10.0 in D2PROCES.
C     .  Modified 06-Oct-87 by TOV to allow processing for tissue activity
C     .    either with decay correction, as well as without;
C     .    (add PETTDCOR to common block; PROCESS may be 0-5 instead of 0-3)
C     .    (altered:  SPIDERAM.FTN, SPIDERAM.INC, M2ANALYZ, M2DISPLA,
C     .    M2GLOBAL, M2INIT, D2BARLAB, D2BARTWO, D2GETIMG, D2OPTION,
C     .    D2OXYGEN, D2PRCIMG, D2PROCES, G2MEANRG, G2WHOLES)
C     .  Modified by TOV 30-Dec-87:
C     .  1) Read write-protected .REG files (R2GET).
C     .  2) Default REFRESH=FALSE, NUMDISP=7 (M2INIT).
C     .  3) Use SCANNAME(n) as file name to write in D2LABEL4 and D2BARLAB.
C     .  4) Regional statistics written to terminal instead of to Ramtek (R2STATS).
C     .  5) Option to scale to slice maximum with rows of 7
C     .    (SPIDERAM.INC,M2INIT,M2DISPLA,D2DISPLA,D2OPTION).
C     .  6) Corrected a bug in D2COMPAR (row and col indices
C     .    were reversed in the DO loops).
C     .  7) Added color table 42 to prompts in M2SCALE.
C     .  8) Fixed R2FLIP so that irregular regions are reversed
C     .    symmetrically and not just shifted.
C     .  9) A2PRINT altered to print region file name and type
C     .    processing used in automatic region processing.
C     .  Modified by TOV 15-Sep-88:
C     .  1) Read PETT VI filter name (D2GETIMG).
C     .  2) Eliminate REFRESH from **DISPLAY common block.
C     .    (SPIDERAM.INC,D2OPTION,D2DISPLA,M2INIT,M2DISPLA)
C     .  3) Change FILETP from I*4 to CH*23 in **DISPLAY common block.
C     .    (SPIDERAM.INC,D2OPTION,D2TEMPLA,M2INIT,M2DISPLA,M2GLOBAL,M2SPLIT,G2WHOLES)
C     .  4) Fix bug in M2GLOBAL.  Now, global processing locally resets
C     .    ABSSCALE-->true, ABSRANGE-->false, and COMPARE-->false.
C     .  5) Include VERSION date in **LUINFO and in all printouts.
C     .    (SPIDERAM.INC,A2PRINT,G2MEANRG,G2WHOLES)
C     .  6) Set SCANNAME(3) in D2PRCIMG when the third file
C     .    used in comparisons is the same as either 1 or 2.
C     .  7) Correct a bug in SCALER, which was not computed properly
C     .    during division with processed images. (D2COMPAR)
C     .  8) Eliminate a confusing scale factor for images with a divisor.
C     .    The scale factor is now incorporated into SCALER(1) in D2COMPAR.
C     .    (D2SCALER,D2DISPLA,D2COMPAR,D2BARLAB,D2BARTWO)
C     .  Modified 02-Oct-89 by TOV:
C     .  1) Scale appropriately for templated 49-slice images (TEMPLATE=4) in D2MAXVAL
C     .  Modified 14-Nov-89 by TOV:
C     .  1) Read and display Scanditronix PC2048-15B images read from
C     .    tape and converted to Super PETT IIH format by SPGET. (D2GETIMG,GETIMAGE)
C     .  Modified 03-Jan-90 by TOV:
C     .  1) Allow templates to be created with 15-slice images (instead of 14).
C     .    (SPIDERAM.INC,M2DISPLA,D2TEMPLA,M2INIT)
C     .  Modified 01-Feb-90 by TOV:
C     .  1) Write stereotaxic section numbers for images with
C     .    49 slices (assumed to be SARP images). (D2DISPLA, D2LABEL2, D2LABEL4)
C     .  2) Correct bug in M2FILES and M2FASTF in which SLCNUM
C     .    was not assigned a value prior to calling D2GETIMG.
C     .  Modified by TOV 09-Feb-90 to eliminage bug in computing mean values
C     .    for multiple scan files. (G2MEANRG)
C     .  Modified by Tom Yang on Sep. 24, 1991 to delete the Fast Scan File
C     .    menu from the main menu when porting to Sun Workstation.
C     .  Modified by TOV 14-Oct-91
C     .  1) MULTFACT(20) scan factors may be automatically entered
C     .    during global averaging. (M2GLOBAL, G2WHOLES, G2MEANRG)
C     .  2) Option U=Unix Path added to main menu.
C     .    Replace GETIMAGE with GETUIMAGE.
C     .    (main, spideram.inc, M2FILES, D2GETIMG)
C     .  Modified by Tom Yang on Feb. 23, 1992 to add menu for saving
C     .    ramtek screen as window dump files. 
C     .  Modified by TOV 14-Apr-92
C     .  1) allow templating of 49-slice images (m2displa)
C     .  Modified by Tom Yang on 27-Apr-92
C     .  1) use standard library functions from libpetutil (getuimage.f)
C     .  2) read ECAT images (getuimage.f).
C     .  Modified by Tom Yang on 28-Apr-92
C     .  1) process ECAT images (d2getimg.f).
C     .  Modified by Tom Yang on 29-Sep-92
C     .    Changed processing for ECAT attenuation images.
C     .  Modified by Tom Yang on 06-Oct-92
C     .    Display ECAT transmission images.
C     .  Modified by Tom Yang on 12-Oct-92
C     .    Replace CTOI with NEWCTOI in m2global.f, m2split.
C     .  Modified by Tom Yang on 21-Oct-92
C     .    Changed scaling factor of ECAT image to 1.0.
C     .  Modified by Tom Yang on 28-Oct-92
C     .    Read .hdr or .HDR header files (d2getimg.f).
C     .  Modified by Tom Yang on 29-Dec-92
C     .    Save and get regions on an ECAT image (r2get.f, r2save.f). 
C     .  Modified by TOV:
C     .  1) process NTYPE = 11 and 12
C     .  2) add rcsheader to all modules
C     .  Modified by Tom Yang on 18-Nov-93 
C     .  1) Added the button release signal.
C     .  2) Changed the region extension from REG to reg.
C     .  Modified by Tom Yang on 24-Nov-93 
C     .  1) XRAMEXIT is changed in libpe.a and an extra argument is added as a flag.
C     .  2) Use color table 40 as the default color table.
C     .  Modified by Tom Yang on 07-Jan-94 
C     .  1) Allow templates to be created for images with more than 49 slices.
C     .  2) Close TDISK and STDISK at exit.
C     .  Modified by Tom Yang on 14-Jan-94 
C     .  1) Global averaging for images with more than 49 slices.
C     .  2) Display of images with more than 49 slices.
C     .  Modified by Tom Yang on 21-Jan-94 to add copyright message. 
C     .  Modified by Tom Yang on 08-Feb-94 to fix the split brain display bug.
C     .  Modified by Tom Yang on 25-May-94 to read reg files generated from the 
C     .    program locate. Files that are changed are m2region.f and r2get.f. 
C     .  Modified by Tom Yang on 06-June-94 to add arguments for RAMINI.
C     .  Modified by Tom Yang on 10-June-94 to add PCFLAG for RAMIMG.
C     .  Modified by Tom Yang on 16-June-94 to move down the save screen menu.
C     .  Modified by Tom Yang on 17-June-94 to make spideram work both on the Workstation
C     .    and on the PCs.
C     .  Modified 16-Aug-94 TOV
C     .  1) Close rgt files after writing to force output to disk (a2save.f)
C     .  2) Use lowercase "rgt" instead of "RGT" (a2save.f)
C     .  Modified by Tom Yang on 29-Nov-94 
C     .  1) Added global variables NRMVALUE and GLBSTART (spideram.inc)
C     .  2) Added processing to let users specify only the number of slices
C     .    and the initial slice for global averages (m2global.f, g2wholes.f, 
C     .    g2meanrg.f, and m2init.f).
C     .  3) Fixed the bug for NRMVALUE (m2global.f)
C     .  Modified 1-Jun-2001 TOV
C     .  1) Add steady-state oxygen processing (d2oxygen.f, d2meanrg.f)
C     
C     Common blocks from SPIDERAM.INC
C     .  **LUINFO  - logical units (also /USRIO/)
C     **FILES   - scan file list
C     
C     Uses Subroutines:
C     
C     FIELDS.LIB - terminal I/O routines using fields:
C     TERMSET  - set terminal control parameters;
C     TCONTROL - terminal control;
C     CHFIELD  - get a character from terminal;
C     WRTFIELD - write a character string to a field;
C     ERSFIELD - erase a field;
C     QUERY    - get Y or N response from a field;
C     
C     SPIDERAM.LIB - main subroutines for SPIDERAM:
C     M2INIT   - initialize parameters;
C     M2DISPLA - display options;
C     M2SCALE  - color scales options;
C     M2FASTF  - fast entry of scan file list;
C     M2FILES  - scan file list;
C     M2GLOBAL - global averaging;
C     M2SPLIT  - half-brain or split images;
C     M2REGION - regions;
C     M2ANALYZ - regions analysis;
C     
C     RAMUTY.LIB - Ramtek utilities:
C     RAMINI   - initialize Ramtek;
C     RAMRST   - reset Ramtek;
C     
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     rcsheader = "$Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.6 2002/12/02 21:26:52 tom Exp tom $"

      PROGRAM SPIDERAM 

      CHARACTER*256 LIBPATH     ! directory where the color tables and data files are located
      CHARACTER*40  PCSTR       ! string containing the option "-pc"

      CHARACTER*1   CH          ! input character for selecting a menu option
      CHARACTER*80  TITLE (2)   ! menu title
      CHARACTER*80  COPYRGHT (2) ! copyright message
      CHARACTER*80  MENU (12)   ! menu options
      CHARACTER*80  MENUSET     ! set of characters allowed for menu options
      CHARACTER*80  Q           ! query to user
      CHARACTER*30  USERNAME    ! user name
      CHARACTER*80  TPLTFILE    ! template file name
      CHARACTER*80  TMPPATH     ! template path name
      CHARACTER*40  CLEAR       ! used to clear a string 

      INTEGER*4     AUXLU       ! log unit containing the terminal type
      INTEGER*4     VOLLU       ! log unit containing default volume names
      INTEGER*4     ROWCH, COLCH ! location of the field for entering CH
      INTEGER*4     WARNLINE    ! line no. to write warning messages on
      INTEGER*4     L1, L2, L
      INTEGER*4     RMFILE

      LOGICAL*1     A           ! answer
      LOGICAL*1     NEXT
      LOGICAL*1     PRINTON     
      LOGICAL*1     PATHOK     
      LOGICAL*1     XWDEXT     
      LOGICAL*1     XWDFLAG     

      INCLUDE 'spideram.inc'

      DATA USERIN,USEROUT,DISK,TDISK,STDISK /5,6,4,8,9/
      DATA RMD, PRINTER /10, 11/
      DATA AMAX  /128/
      DATA AUXLU, VOLLU  /13, 14/
      DATA FONT1C,FONT2C  /1,2/

      DATA TITLE(1) /'   Super PETT Image Display Employing   '/
      DATA TITLE(2) /'Regional Analysis & Metabolic Conversion'/
      DATA VERSION  /'20-Feb-2004'/
      DATA COPYRGHT(1) /'Copyright 1985-2004 Washington University.'/
      DATA COPYRGHT(2) /'All rights reserved.'/
      DATA MENU(1)  /'D = Display Options'/
      DATA MENU(2)  /'C = Color Scales'/
      DATA MENU(3)  /'S = Scan File List'/
      DATA MENU(4)  /'U = Unix Path Selection'/
      DATA MENU(5)  /'R = Regions'/
      DATA MENU(6)  /'A = Analysis of Regions'/
      DATA MENU(7)  /'G = Global Averaging'/
      DATA MENU(8)  /'H = Half-Brain or Split Images'/
      DATA MENU(9)  /'P = Print Current Output File'/
      DATA MENU(10) /'W = Save Screen Image as Window Dump'/
      DATA MENU(11) /'0 = Refresh Ramtek Screen'/
      DATA MENU(12) /'X = Exit'/
      DATA MENUSET  /'DCSURAGHPW0Xdcsuraghpwx'/
      DATA OUTFILE  /'PRINTER'/
      DATA CLEAR    /'                                        '/

      DATA ROWCH, COLCH, WARNLINE /22, 20, 24/

C     Get the command line arguments.

      CALL GETARG (1, LIBPATH)
      CALL GETARG (2, PCSTR)
      IF (PCSTR .EQ. "-pc") THEN
         PCFLAG = 1
      ELSE
         PCFLAG = 0
      ENDIF

C     Read default volume name for .IMG and .HDR files
C     and remove the colon if present

      CALL GETUSER (USERNAME) 
      TPLTFILE = '/tmp/SPIDTPLT.'//USERNAME
      L = INANYR (LIBPATH, ' ')
      OPEN (TDISK, FILE = TPLTFILE)
      OPEN (STDISK, FILE = LIBPATH (1:L)//'/SPIDTP40.49')

C     Initialize variables

      CALL M2INIT

C     Get terminal type for terminal control subroutines

      CALL TERMSET (AUXLU, LIBPATH)

C     Set planes for regions, coronal & mid-lines, statistics.
C     (color tables for images uses 1-256 and 300-500;
C     overlay planes are 2**10 and 2**12 on RASPUTIN
C     and 2**12 and 2**13 on all other Ramteks,
C     but overlay plane white is ~90% of brightest image white)

      ZORIGIN  = 31
      TEMPLANE = 2**12
      REGPLANE = 2**11
      FIXPLANE = 2**12 - 1

C     Initialize the Ramtek

      CALL RAMINI (0, 20, 1200, 1000, 40, PCFLAG, LIBPATH)
      CALL RAMRST (RMD)

C     Clear the screen and write the menu

 8080 FORMAT (20X, A40)
 8081 FORMAT (27X, '{', A21, '}')
 8082 FORMAT (32X, '{', A11, '}')
 8083 FORMAT (19X, A43)
 8084 FORMAT (11X, A58)
 8090 FORMAT(27X,A40)

 100  CALL TCONTROL (1, 0, 0)
      CALL TCONTROL (2, 0, 0)
      WRITE (USEROUT, 8080) TITLE (1)
      WRITE (USEROUT, 8080) TITLE (2)
      WRITE (USEROUT, *) 
      IF (PCFLAG .EQ. 1) THEN
         WRITE (USEROUT, 8081) 'pcspideram, 17-Jun-94'
      ELSE
         WRITE (USEROUT, 8082) VERSION
      ENDIF
      WRITE (USEROUT, *)
      WRITE (USEROUT, 8083) COPYRGHT (1)
      WRITE (USEROUT, 8084) COPYRGHT (2)
      WRITE (USEROUT, *) 
      DO 120 I = 1, 12
         WRITE (USEROUT, 8090) MENU(I)
 120  CONTINUE

      CALL CLEANUP (TPLTFILE) 
C     Get user's request

 200  CALL CHFIELD (CH, MENUSET, ROWCH, COLCH, WARNLINE)

      IF (CH .EQ. 'D' .OR. CH .EQ. 'd') THEN
         CALL M2DISPLA
      ELSE IF (CH .EQ. 'C' .OR. CH .EQ. 'c') THEN
         CALL M2SCALE (LIBPATH)
      ELSE IF (CH .EQ. 'S' .OR. CH .EQ. 's') THEN
         CALL M2FILES
      ELSE IF (CH.EQ.'U' .OR. CH.EQ.'u') THEN
 300     CALL WRTFIELD ('Path for image files', 20, ROWCH, 1)
         CALL ERSFIELD (80, ROWCH + 1, 1)
         CALL INFIELD (IMGVOL, 80, ROWCH + 1, 1, NEXT)
         L1 = IANYR (IMGVOL, '/')
         L2 = INANYR (IMGVOL, ' ')
         IF (L1 .LT. L2 .AND. L2 .LT. 80) THEN
            IMGVOL (L2+1:L2+1) = '/'
            L = L2 + 1
         ELSE
            L = L2
         ENDIF
         PATHOK = .TRUE.
         IF (L .GT. 0) THEN
            TMPPATH = CLEAR//CLEAR
            TMPPATH = IMGVOL (1:L)
            TMPPATH (L+1:L+1) = '.'
            CALL CHKPATH (TMPPATH, L + 1, PATHOK)
         ENDIF
         IF (PATHOK .EQV. .FALSE.) THEN
            WRITE (USEROUT, *) CHAR (7) 
            CALL WRTFIELD ('*** ERROR- Image path does not exist! ***',
     &           43, WARNLINE, 1)
            GO TO 300
         ELSE
            CALL ERSFIELD (43, WARNLINE, 1)
         ENDIF

 400     CALL WRTFIELD ('Path for HDR files', 18, ROWCH + 2, 1)
         CALL ERSFIELD (80, ROWCH + 3, 1)
         CALL INFIELD (HDRVOL, 80, ROWCH + 3, 1, NEXT)
         L1 = IANYR (HDRVOL, '/')
         L2 = INANYR (HDRVOL, ' ')
         IF (L1 .LT. L2 .AND. L2 .LT. 80) THEN
            HDRVOL (L2+1:L2+1) = '/'
            L = L2 + 1
         ELSE
            L = L2
         ENDIF
         PATHOK = .TRUE.
         IF (L .GT. 0) THEN
            TMPPATH = CLEAR//CLEAR
            TMPPATH = HDRVOL (1:L)
            TMPPATH (L+1:L+1) = '.'
            CALL CHKPATH (TMPPATH, L + 1, PATHOK)
         ENDIF
         IF (PATHOK .EQV. .FALSE.) THEN 
            WRITE (USEROUT, *) CHAR (7) 
            CALL WRTFIELD ('*** ERROR- Header path does not exist! ***',
     &           44, WARNLINE, 1)
            GO TO 400
         ELSE
            CALL ERSFIELD (44, WARNLINE, 1)
         ENDIF

C     ELSE IF (CH.EQ.'F' .OR. CH.EQ.'f') THEN
C     CALL M2FASTF
      ELSE IF (CH.EQ.'R' .OR. CH.EQ.'r') THEN
         CALL M2REGION
      ELSE IF (CH.EQ.'A' .OR. CH.EQ.'a') THEN
         CALL M2ANALYZ
      ELSE IF (CH.EQ.'G' .OR. CH.EQ.'g') THEN
         CALL M2GLOBAL
      ELSE IF (CH.EQ.'H' .OR. CH.EQ.'h') THEN
         CALL M2SPLIT
      ELSE IF (CH.EQ.'P' .OR. CH.EQ.'p') THEN
         INQUIRE (PRINTER, OPENED = PRINTON)
         IF (PRINTON) CLOSE (PRINTER)
         CALL PRNTFILE (OUTFILE)
      ELSE IF (CH .EQ. 'W' .OR. CH .EQ. 'w') THEN
         CALL WRTFIELD ('Window dump file name', 21, ROWCH, 1)
         CALL ERSFIELD (40, ROWCH + 1, 1)
         CALL INFIELD (DUMPNAME, 40, ROWCH + 1, 1, NEXT)
         L1 = INANYR (DUMPNAME, ' ')
         IF (IANYR (DUMPNAME, ".xwd") .NE. L1 .AND.
     &        IANYR (DUMPNAME, ".XWD") .NE. L1) THEN
            XWDEXT = .FALSE.
            L2 = L1 + 4
         ELSE
            XWDEXT = .TRUE.
            L2 = L1
         ENDIF
         IF (XWDEXT .EQV. .FALSE.) THEN
            DUMPNAME(L1+1:L1+4) = '.xwd'
         ENDIF
         CALL WRTFIELD ('Make sure the part of the window '//
     &        'you want to save is viewable.', 62, ROWCH + 2, 1)
         CALL WRTFIELD ('After you are ready, press the '//
     &        'key s or S to save.', 50, ROWCH + 3, 1)

C     Check the keyboard until 's' or 'S' is keyed in.

         XWDFLAG = .FALSE.
 700     CALL XWDCHCK (XWDFLAG)
         IF (.NOT. XWDFLAG) GO TO 700
         CALL WINDUMP (.FALSE., 0, 0, 0, 0, DUMPNAME, L2)

      ELSE IF (CH .EQ. '0') THEN
         CALL RAMRST (RMD)
      ELSE IF (CH .EQ. 'X' .OR. CH .EQ. 'x') THEN
         Q = 'EXIT?'
         CALL QUERY(Q,A,ROWCH,COLCH)
         CALL ERSFIELD(10,ROWCH,COLCH)
         IF (A) THEN
            CLOSE (TDISK)
            CLOSE (STDISK)
            RMFILE = 1
            CALL XRAMEXIT ("rm " // TPLTFILE, RMFILE)
            STOP
         ELSE
            GO TO 200
         END IF
      ELSE
         GO TO 200
      END IF
      GO TO 100

      END
@


1.6
log
@format changes plus fixes for g77
@
text
@d1 1
a1 1
C     $Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.5 2001/06/01 15:40:17 tom Exp tom $
d3 3
d388 1
a388 1
C     rcsheader = "$Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.5 2001/06/01 15:40:17 tom Exp tom $"
d430 2
a431 2
      DATA VERSION  /'02-Dec-2002'/
      DATA COPYRGHT(1) /'Copyright 1985-2002 Washington University.'/
@


1.5
log
@fix d2oxygen.f
@
text
@d1 183
a183 180
C $Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.4 2001/05/30 20:01:40 tom Exp tom $
C $Log: spideram.f,v $
c Revision 1.4  2001/05/30  20:01:40  tom
c version expanded to 11 chars
c
c Revision 1.3  2001/05/30  19:46:30  tom
c add steady-state oxygen processing
c
c Revision 1.2  1999/12/15  21:33:36  tom
c y2k fix
c
c Revision 1.1  1999/12/14  16:12:02  tom
c Initial revision
c
c Revision 1.65  1999/08/09  14:04:36  tom
c increase BOUNDARY from 2000 -> 20000 points
c
c Revision 1.64  1999/03/05  18:49:14  tom
c add CVO2
c
c Revision 1.63  1999/02/17  18:43:30  tom
c add 8x6 and 3x2 displays for PC uinsg 1024x768 screen resolution
c
c Revision 1.62  1998/04/29  15:20:35  tom
c allow processing for CMRGlucose
c
c Revision 1.61  1997/10/24  21:52:34  tom
c add NOZEROS option to g2wholes.f and m2global.f
c
c Revision 1.60  1997/10/16  18:26:56  tom
c modified r2save for handling CT images
c
c Revision 1.59  1997/06/04  19:15:38  tom
c add fill option 'Q' to m2region
c change LEN in p2point
c
c Revision 1.58  1996/10/23  21:48:21  tom
c modify r2get, r2save, m2region for EXACT HR scanner
c
c Revision 1.57  1996/10/16  17:01:57  tom
c new libimage
c
c Revision 1.56  1996/09/26  17:57:40  tom
c Solaris
c
c Revision 1.55  1996/08/05  14:29:56  tom
c new libimage and getimage.c
c
c Revision 1.54  1996/05/21  21:45:02  tom
c revised getimage.c to divide by decay_corr_fctr for matrix 7.0 files
c and to use 10000 as scaler when units are 1/cm
c
c Revision 1.53  1996/04/19  19:58:32  tom
c changed version date
c
c Revision 1.52  1996/02/19  22:51:50  tom
c change getimage.c to display 961 transmission images
c
c Revision 1.51  1995/12/20  16:43:52  tom
c new libimg.a
c
c Revision 1.50  1995/12/19  14:34:46  tom
c revised getimage.c
c
c Revision 1.49  1995/12/12  20:41:49  tom
c original for version 7
c
c Revision 1.48  1995/11/10  16:39:08  tom
c update with new libnpg to read 961 images
c
c Revision 1.47  1995/10/31  19:07:39  tom
c changed Version date
c
c Revision 1.46  1994/11/29  23:33:24  ty7777
c Changed the date.
c
c Revision 1.45  1994/11/29  23:09:32  ty7777
c Use initial slice and number of slices for GBA.
c
c Revision 1.44  1994/08/16  16:37:01  tom
c Modified a2save.f to use lowercase "rgt" and to close file after write.
c
c Revision 1.43  1994/06/17  21:30:56  ty7777
c Added message for PC display.
c
c Revision 1.42  1994/06/17  21:17:46  ty7777
c Change the date format for pc screen.
c
c Revision 1.41  1994/06/16  21:00:59  ty7777
c The current version works on both the Workstation and the PCs.
c
c Revision 1.40  1994/06/14  15:57:23  ty7777
c Move down the save window dump menu.
c
c Revision 1.39  1994/06/10  15:06:46  ty7777
c Use the PCFLAG in ramimg ().
c
c Revision 1.38  1994/06/06  17:56:35  ty7777
c Correct the date.
c
c Revision 1.37  1994/06/06  17:07:54  ty7777
c Update the date.
c
c Revision 1.36  1994/06/06  17:00:49  ty7777
c Added arguments for ramini ().
c
c Revision 1.35  1994/05/25  20:17:47  ty7777
c Modified to read reg files generated from locate.
c
c Revision 1.34  1994/05/02  16:40:18  ty7777
c Added initialization for the zorigin.
c
c Revision 1.33  1994/02/08  20:32:56  ty7777
c Fixing the color bar display problem in half brain.
c
c Revision 1.32  1994/01/27  16:10:44  ty7777
c Changed the Unix path input place.
c
c Revision 1.31  1994/01/21  18:40:37  ty7777
c Added copyright.
c
c Revision 1.30  1994/01/21  18:20:15  ty7777
c Added the copyright message.
c
c Revision 1.29  1994/01/14  19:22:22  ty7777
c Added processing for images with more than 49 slices.
c
c Revision 1.28  1994/01/07  20:50:26  ty7777
c Change the date.
c
c Revision 1.27  1994/01/07  20:49:30  ty7777
c Adding template for images with more than 49 slices.
c
c Revision 1.26  1993/11/24  20:31:25  ty7777
c RAMINI is changed.
c
c Revision 1.25  1993/11/24  17:30:54  ty7777
c Added RMFILE to XRAMEXIT.
c
c Revision 1.24  1993/11/18  20:11:57  ty7777
c Changed region extension.
c
c Revision 1.23  1993/11/18  20:04:30  ty7777
c libpe.a is changed to process the ButtonRelease signal.
c
c Revision 1.22  1993/10/05  21:20:50  tom
c new version for x-reversed ecat images
c
c Revision 1.21  1993/10/04  21:55:32  tom
c added ability to display ntype = 11 or 12 (oef and cmro2 from t88mean)
c
c Revision 1.20  1993/07/14  18:50:40  ty7777
c Rebuilt with new libraries libpetutil.a. Use default ecat_calibration_fctr
c if the one in the image_subheader is 0.
c
c Revision 1.19  1993/07/12  21:20:26  tom
c Rebuilt with new libpetutil:
c pixel value = pixel * quant_factor * frame_duration * ecat_calibration_fctr
c
c Revision 1.18  1993/03/04  16:30:25  ty7777
c Before moving to HP machines.
c
c Revision 1.17  1992/12/08  21:10:12  ty7777
c Before calling libcti library.
c
c Revision 1.16  1992/10/21  16:14:22  ty7777
c Changed scaling factor of ECAT images to 1.0.
c
c Revision 1.15  1992/10/13  19:47:34  ty7777
c Replace CTOI with NEWCTOI.
c
c Revision 1.14  1992/10/08  15:49:24  ty7777
c Before libpetutil library changed.
c
c Revision 1.13  1992/08/21  20:15:51  ty7777
c Testing RCS checking in.
c
c Revision 1.12  1992/08/21  20:11:10  ty7777
c After fixing ECAT number of slices bug.
c
d185 12
a196 14
C
C  Program:      spideram.f
C
C  Author:       Tom O. Videen
C  Date:         12-Jun-87
C  Written For:  Super PETT II Image Display Program
C
C  Intent:
C     This is an interactive program for displaying PET images,
C     defining regions on them, and performing statistical
C     calculations on defined regions.
C     This program presents the main menu and call subroutines to
C     execute the option selected.
C
d198 159
a356 164
C
C  History:
C     Modified 09-Aug-99 by TOV to allow increase irreg reg points 2000->20000
C     Modified 05-Mar-99 by TOV to allow processing for CVO2
C        (PROCESS may be 0-7)
C        (altered:  main d2barlab d2bartwo d2option d2prcimg d2oxygen
C         g2meanrg g2wholes m2analyz m2displa m2global a2print)
C     Modified 29-Apr-98 by TOV to allow processing for CMRGlucose:
C        (PROCESS may be 0-6)
C        (altered:  main d2barlab d2bartwo d2option d2prcimg d2proces
C        g2meanrg g2wholes m2analyz m2displa m2global)
C     Modified by TOV 16-Jul-87:
C       1) change record length of .REG file from 256 to 80;
C       2) color scaling ranges from 0-240 for normal images
C            (instead of 0-256) and from 320-480 for relative images
C            (instead of 300-500); COLOR40 and 41 are default tables;
C       3) correct bug in scaling quarter screen images to individual max;
C     Modified by TOV 12-Aug-87:
C       1) allow GETIMAGE to read write-protected files by avoiding
C            a compiler bug for INQUIRE statements;
C       2) eliminate a bug in error checking for max. number of sections
C            to display for coronal and sagittal sections;
C     Modified by TOV 21-Aug-87:
C       1) M2FILES delete option reinitializes PETTNUM and NMSLICES
C            iff there are no files remaining in the list;
C       2) Add a fast file entry option in SPIDERAM (subroutine M2FASTF);
C     Modified by TOV 26-Aug-87:
C       1) eliminate a bug in right/left hemisphere values in G2WHOLES;
C       2) allow selection of a different midline value in M2GLOBAL
C            without returning to the regions menu;
C     Modified by TOV 03-Sep-87:
C       1) correct a bug in A2SAVE in write format for RGT files;
C       Note: Dan Schuster wants an RGT file with 80 columns which
C          requires a modification of A2SAVE.
C     Modified 11-Sep-87 by TOV to add messages for overriding
C        non-blank file extensions in M2FASTF.
C     Modified 15-Sep-87 by TOV to correct a minor bug in the
C        displayed menu in A2ANALYZ.
C     Modified 02-Oct-87 by TOV to set SCALER for tissue activity
C        processing to 10.0 in D2PROCES.
C     Modified 06-Oct-87 by TOV to allow processing for tissue activity
C        either with decay correction, as well as without;
C        (add PETTDCOR to common block; PROCESS may be 0-5 instead of 0-3)
C        (altered:  SPIDERAM.FTN, SPIDERAM.INC, M2ANALYZ, M2DISPLA,
C         M2GLOBAL, M2INIT, D2BARLAB, D2BARTWO, D2GETIMG, D2OPTION,
C         D2OXYGEN, D2PRCIMG, D2PROCES, G2MEANRG, G2WHOLES)
C     Modified by TOV 30-Dec-87:
C       1) Read write-protected .REG files (R2GET).
C       2) Default REFRESH=FALSE, NUMDISP=7 (M2INIT).
C       3) Use SCANNAME(n) as file name to write in D2LABEL4 and D2BARLAB.
C       4) Regional statistics written to terminal instead of to Ramtek
C          (R2STATS).
C       5) Option to scale to slice maximum with rows of 7
C          (SPIDERAM.INC,M2INIT,M2DISPLA,D2DISPLA,D2OPTION).
C       6) Corrected a bug in D2COMPAR (row and col indices
C           were reversed in the DO loops).
C       7) Added color table 42 to prompts in M2SCALE.
C       8) Fixed R2FLIP so that irregular regions are reversed
C           symmetrically and not just shifted.
C       9) A2PRINT altered to print region file name and type
C           processing used in automatic region processing.
C     Modified by TOV 15-Sep-88:
C       1) Read PETT VI filter name (D2GETIMG).
C       2) Eliminate REFRESH from **DISPLAY common block.
C          (SPIDERAM.INC,D2OPTION,D2DISPLA,M2INIT,M2DISPLA)
C       3) Change FILETP from I*4 to CH*23 in **DISPLAY common block.
C          (SPIDERAM.INC,D2OPTION,D2TEMPLA,M2INIT,M2DISPLA,M2GLOBAL,
C           M2SPLIT,G2WHOLES)
C       4) Fix bug in M2GLOBAL.  Now, global processing locally resets
C           ABSSCALE-->true, ABSRANGE-->false, and COMPARE-->false.
C       5) Include VERSION date in **LUINFO and in all printouts.
C          (SPIDERAM.INC,A2PRINT,G2MEANRG,G2WHOLES)
C       6) Set SCANNAME(3) in D2PRCIMG when the third file
C          used in comparisons is the same as either 1 or 2.
C       7) Correct a bug in SCALER, which was not computed properly
C          during division with processed images. (D2COMPAR)
C       8) Eliminate a confusing scale factor for images with a divisor.
C          The scale factor is now incorporated into SCALER(1) in D2COMPAR.
C          (D2SCALER,D2DISPLA,D2COMPAR,D2BARLAB,D2BARTWO)
C     Modified 02-Oct-89 by TOV:
C       1) Scale appropriately for templated 49-slice images
C          (TEMPLATE=4) in D2MAXVAL
C     Modified 14-Nov-89 by TOV:
C       1) Read and display Scanditronix PC2048-15B images read from
C          tape and converted to Super PETT IIH format by SPGET.
C          (D2GETIMG,GETIMAGE)
C     Modified 03-Jan-90 by TOV:
C       1) Allow templates to be created with 15-slice images (instead of 14).
C          (SPIDERAM.INC,M2DISPLA,D2TEMPLA,M2INIT)
C     Modified 01-Feb-90 by TOV:
C        1) Write stereotaxic section numbers for images with
C           49 slices (assumed to be SARP images).
C           (D2DISPLA, D2LABEL2, D2LABEL4)
C        2) Correct bug in M2FILES and M2FASTF in which SLCNUM
C           was not assigned a value prior to calling D2GETIMG.
C     Modified by TOV 09-Feb-90 to eliminage bug in computing mean values
C        for multiple scan files. (G2MEANRG)
C     Modified by Tom Yang on Sep. 24, 1991 to delete the Fast Scan File
C        menu from the main menu when porting to Sun Workstation.
C     Modified by TOV 14-Oct-91
C        1) MULTFACT(20) scan factors may be automatically entered
C           during global averaging. (M2GLOBAL, G2WHOLES, G2MEANRG)
C        2) Option U=Unix Path added to main menu.
C           Replace GETIMAGE with GETUIMAGE.
C           (main, spideram.inc, M2FILES, D2GETIMG)
C     Modified by Tom Yang on Feb. 23, 1992 to add menu for saving
C        ramtek screen as window dump files. 
C     Modified by TOV 14-Apr-92
C        1) allow templating of 49-slice images (m2displa)
C     Modified by Tom Yang on 27-Apr-92
C        1) use standard library functions from libpetutil (getuimage.f)
C        2) read ECAT images (getuimage.f).
C     Modified by Tom Yang on 28-Apr-92
C        1) process ECAT images (d2getimg.f).
C     Modified by Tom Yang on 29-Sep-92
C        Changed processing for ECAT attenuation images.
C     Modified by Tom Yang on 06-Oct-92
C        Display ECAT transmission images.
C     Modified by Tom Yang on 12-Oct-92
C        Replace CTOI with NEWCTOI in m2global.f, m2split.
C     Modified by Tom Yang on 21-Oct-92
C        Changed scaling factor of ECAT image to 1.0.
C     Modified by Tom Yang on 28-Oct-92
C        Read .hdr or .HDR header files (d2getimg.f).
C     Modified by Tom Yang on 29-Dec-92
C        Save and get regions on an ECAT image (r2get.f, r2save.f). 
C     Modified by TOV:
C        1) process NTYPE = 11 and 12
C        2) add rcsheader to all modules
C     Modified by Tom Yang on 18-Nov-93 
C        1) Added the button release signal.
C        2) Changed the region extension from REG to reg.
C     Modified by Tom Yang on 24-Nov-93 
C        1) XRAMEXIT is changed in libpe.a and an extra argument is added as a flag.
C        2) Use color table 40 as the default color table.
C     Modified by Tom Yang on 07-Jan-94 
C        1) Allow templates to be created for images with more than 49 slices.
C        2) Close TDISK and STDISK at exit.
C     Modified by Tom Yang on 14-Jan-94 
C        1) Global averaging for images with more than 49 slices.
C        2) Display of images with more than 49 slices.
C     Modified by Tom Yang on 21-Jan-94 to add copyright message. 
C     Modified by Tom Yang on 08-Feb-94 to fix the split brain display bug.
C     Modified by Tom Yang on 25-May-94 to read reg files generated from the 
C        program locate. Files that are changed are m2region.f and r2get.f. 
C     Modified by Tom Yang on 06-June-94 to add arguments for RAMINI.
C     Modified by Tom Yang on 10-June-94 to add PCFLAG for RAMIMG.
C     Modified by Tom Yang on 16-June-94 to move down the save screen menu.
C     Modified by Tom Yang on 17-June-94 to make spideram work both on the Workstation
C        and on the PCs.
C     Modified 16-Aug-94 TOV
C       1) Close rgt files after writing to force output to disk (a2save.f)
C       2) Use lowercase "rgt" instead of "RGT" (a2save.f)
C     Modified by Tom Yang on 29-Nov-94 
C       1) Added global variables NRMVALUE and GLBSTART (spideram.inc)
C       2) Added processing to let users specify only the number of slices
C          and the initial slice for global averages (m2global.f, g2wholes.f, 
C          g2meanrg.f, and m2init.f).
C       3) Fixed the bug for NRMVALUE (m2global.f)
C     Modified 1-Jun-2001 TOV
C       1) Add steady-state oxygen processing (d2oxygen.f, d2meanrg.f)
C
C  Common blocks from SPIDERAM.INC
C     **LUINFO  - logical units (also /USRIO/)
d358 4
a361 4
C
C  Uses Subroutines:
C
C  FIELDS.LIB - terminal I/O routines using fields:
d368 2
a369 2
C
C  SPIDERAM.LIB - main subroutines for SPIDERAM:
d379 2
a380 2
C
C  RAMUTY.LIB - Ramtek utilities:
d383 1
a383 1
C
d385 1
d389 2
a390 2
      CHARACTER*256 LIBPATH      ! directory where the color tables and data files are located
      CHARACTER*40  PCSTR        ! string containing the option "-pc"
d392 2
a393 2
      CHARACTER*1   CH           ! input character for selecting a menu option
      CHARACTER*80  TITLE (2)    ! menu title
d395 7
a401 8
      CHARACTER*80  MENU (12)    ! menu options
      CHARACTER*80  MENUSET      ! set of characters allowed for menu options
      CHARACTER*80  Q            ! query to user
      CHARACTER*30  USERNAME     ! user name
      CHARACTER*80  TPLTFILE     ! template file name
      CHARACTER*80  TMPPATH      ! template path name
      CHARACTER*40  CLEAR        ! used to clear a string 
      CHARACTER*256 RCSHEADER    ! RCS header information
d403 2
a404 2
      INTEGER*4     AUXLU        ! log unit containing the terminal type
      INTEGER*4     VOLLU        ! log unit containing default volume names
d406 1
a406 1
      INTEGER*4     WARNLINE     ! line no. to write warning messages on
d410 1
a410 1
      LOGICAL*1     A            ! answer
a417 1
      rcsheader = "$Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.4 2001/05/30 20:01:40 tom Exp tom $"
d427 3
a429 3
      DATA VERSION  /'01-Jun-2001'/
      DATA COPYRGHT(1) /'Copyright 1985-2001, Washington University.'/
      DATA COPYRGHT(2) /'All rights reserved. Unauthorized reproduction prohibited.'/
d453 1
a453 1
        PCFLAG = 1
d455 1
a455 1
        PCFLAG = 0
d458 2
a459 2
C  Read default volume name for .IMG and .HDR files
C    and remove the colon if present
d467 1
a467 1
C  Initialize variables
d471 1
a471 1
C  Get terminal type for terminal control subroutines
d475 2
a476 2
C  Set planes for regions, coronal & mid-lines, statistics.
C    (color tables for images uses 1-256 and 300-500;
d486 1
a486 1
C  Initialize the Ramtek
d491 1
a491 1
C  Clear the screen and write the menu
d493 6
a498 6
8080  FORMAT (20X, A40)
8081  FORMAT (27X, '{', A21, '}')
8082  FORMAT (32X, '{', A11, '}')
8083  FORMAT (19X, A43)
8084  FORMAT (11X, A58)
8090  FORMAT(27X,A40)
d500 1
a500 1
100   CALL TCONTROL (1, 0, 0)
d506 1
a506 1
        WRITE (USEROUT, 8081) 'pcspideram, 17-Jun-94'
d508 1
a508 1
        WRITE (USEROUT, 8082) VERSION
d515 2
a516 2
        WRITE (USEROUT, 8090) MENU(I)
120   CONTINUE
d519 1
a519 1
C  Get user's request
d521 1
a521 1
200   CALL CHFIELD (CH, MENUSET, ROWCH, COLCH, WARNLINE)
d524 1
a524 1
        CALL M2DISPLA
d526 1
a526 1
        CALL M2SCALE (LIBPATH)
d528 1
a528 1
        CALL M2FILES
d530 26
a555 26
300     CALL WRTFIELD ('Path for image files', 20, ROWCH, 1)
        CALL ERSFIELD (80, ROWCH + 1, 1)
        CALL INFIELD (IMGVOL, 80, ROWCH + 1, 1, NEXT)
        L1 = IANYR (IMGVOL, '/')
        L2 = INANYR (IMGVOL, ' ')
        IF (L1 .LT. L2 .AND. L2 .LT. 80) THEN
          IMGVOL (L2+1:L2+1) = '/'
          L = L2 + 1
        ELSE
          L = L2
        ENDIF
        PATHOK = .TRUE.
        IF (L .GT. 0) THEN
          TMPPATH = CLEAR//CLEAR
          TMPPATH = IMGVOL (1:L)
          TMPPATH (L+1:L+1) = '.'
          CALL CHKPATH (TMPPATH, L + 1, PATHOK)
        ENDIF
        IF (PATHOK .EQ. .FALSE.) THEN
          WRITE (USEROUT, *) CHAR (7) 
          CALL WRTFIELD ('*** ERROR -- Image path does not exist! ***',
     &      43, WARNLINE, 1)
          GO TO 300
        ELSE
          CALL ERSFIELD (43, WARNLINE, 1)
        ENDIF
d557 26
a582 26
400     CALL WRTFIELD ('Path for HDR files', 18, ROWCH + 2, 1)
        CALL ERSFIELD (80, ROWCH + 3, 1)
        CALL INFIELD (HDRVOL, 80, ROWCH + 3, 1, NEXT)
        L1 = IANYR (HDRVOL, '/')
        L2 = INANYR (HDRVOL, ' ')
        IF (L1 .LT. L2 .AND. L2 .LT. 80) THEN
          HDRVOL (L2+1:L2+1) = '/'
          L = L2 + 1
        ELSE
          L = L2
        ENDIF
        PATHOK = .TRUE.
        IF (L .GT. 0) THEN
          TMPPATH = CLEAR//CLEAR
          TMPPATH = HDRVOL (1:L)
          TMPPATH (L+1:L+1) = '.'
          CALL CHKPATH (TMPPATH, L + 1, PATHOK)
        ENDIF
        IF (PATHOK .EQ. .FALSE.) THEN 
          WRITE (USEROUT, *) CHAR (7) 
          CALL WRTFIELD ('*** ERROR -- Header path does not exist! ***',
     &      44, WARNLINE, 1)
          GO TO 400
        ELSE
          CALL ERSFIELD (44, WARNLINE, 1)
        ENDIF
d585 1
a585 1
C       CALL M2FASTF
d587 1
a587 1
        CALL M2REGION
d589 1
a589 1
        CALL M2ANALYZ
d591 1
a591 1
        CALL M2GLOBAL
d593 1
a593 1
        CALL M2SPLIT
d595 23
a617 23
        INQUIRE (PRINTER, OPENED = PRINTON)
        IF (PRINTON) CLOSE (PRINTER)
        CALL PRNTFILE (OUTFILE)
        ELSE IF (CH .EQ. 'W' .OR. CH .EQ. 'w') THEN
        CALL WRTFIELD ('Window dump file name', 21, ROWCH, 1)
        CALL ERSFIELD (40, ROWCH + 1, 1)
        CALL INFIELD (DUMPNAME, 40, ROWCH + 1, 1, NEXT)
        L1 = INANYR (DUMPNAME, ' ')
        IF (IANYR (DUMPNAME, ".xwd") .NE. L1 .AND.
     &      IANYR (DUMPNAME, ".XWD") .NE. L1) THEN
          XWDEXT = .FALSE.
          L2 = L1 + 4
        ELSE
          XWDEXT = .TRUE.
          L2 = L1
        ENDIF
        IF (XWDEXT .EQ. .FALSE.) THEN
          DUMPNAME(L1+1:L1+4) = '.xwd'
        ENDIF
        CALL WRTFIELD ('Make sure the part of the window '//
     &    'you want to save is viewable.', 62, ROWCH + 2, 1)
        CALL WRTFIELD ('After you are ready, press the '//
     &    'key s or S to save.', 50, ROWCH + 3, 1)
d621 4
a624 4
        XWDFLAG = .FALSE.
700     CALL XWDCHCK (XWDFLAG)
        IF (.NOT. XWDFLAG) GO TO 700
        CALL WINDUMP (.FALSE., 0, 0, 0, 0, DUMPNAME, L2)
d627 1
a627 1
        CALL RAMRST (RMD)
d629 12
a640 12
        Q = 'EXIT?'
        CALL QUERY(Q,A,ROWCH,COLCH)
        CALL ERSFIELD(10,ROWCH,COLCH)
        IF (A) THEN
          CLOSE (TDISK)
          CLOSE (STDISK)
          RMFILE = 1
          CALL XRAMEXIT ("rm " // TPLTFILE, RMFILE)
          STOP
        ELSE
          GO TO 200
        END IF
d642 1
a642 1
        GO TO 200
@


1.4
log
@version expanded to 11 chars
@
text
@d1 1
a1 1
C $Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.3 2001/05/30 19:46:30 tom Exp tom $
d3 3
d356 1
a356 1
C     Modified 30-May-2001 TOV
d422 1
a422 1
      rcsheader = "$Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.3 2001/05/30 19:46:30 tom Exp tom $"
d432 1
a432 1
      DATA VERSION  /'30-May-2001'/
@


1.3
log
@add steady-state oxygen processing
@
text
@d1 1
a1 1
C $Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.2 1999/12/15 21:33:36 tom Exp $
d3 3
d419 1
a419 1
      rcsheader = "$Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.2 1999/12/15 21:33:36 tom Exp $"
d497 1
a497 1
8082  FORMAT (33X, '{', A9, '}')
@


1.2
log
@y2k fix
@
text
@d1 1
a1 1
C $Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.1 1999/12/14 16:12:02 tom Exp tom $
d3 3
d197 1
a197 1
C		 g2meanrg g2wholes m2analyz m2displa m2global a2print)
d201 1
a201 1
C		 g2meanrg g2wholes m2analyz m2displa m2global)
d299 1
a299 1
C			   1) allow templating of 49-slice images (m2displa)
d301 1
a301 2
C	 1) use standard library functions from libpetutil.
C		(getuimage.f)
d318 2
a319 2
C	 1) process NTYPE = 11 and 12
C	 2) add rcsheader to all modules
d340 1
a340 1
C	and on the PCs.
d350 2
d383 1
a383 1
C
d385 1
a385 1
C
d400 1
a400 1
C
d407 1
a407 1
C
d414 1
a414 1
C
d416 1
a416 1
      rcsheader = "$Header: /home/npggw/tom/src/spideram/RCS/spideram.f,v 1.1 1999/12/14 16:12:02 tom Exp tom $"
d423 1
a423 1
C
d426 2
a427 2
      DATA VERSION  /'15-Dec-1999'/
      DATA COPYRGHT(1) /'Copyright 1985-1999, Washington University.'/
d444 1
a444 1
C
d446 1
a446 1
C
d448 1
a448 1
C
d456 1
a456 1
C
d459 1
a459 1
C
d465 1
a465 1
C
d467 1
a467 1
C
d469 1
a469 1
C
d471 1
a471 1
C
d473 1
a473 1
C
d479 1
a479 1
C
d484 1
a484 1
C
d486 1
a486 1
C
d489 1
a489 1
C
d491 1
a491 1
C
d498 1
a498 1
C
d514 1
a514 1
	WRITE (USEROUT, 8090) MENU(I)
d516 1
a516 1
C
d519 1
a519 1
C
d521 1
a521 1
C
d529 14
a542 14
300	CALL WRTFIELD ('Path for image files', 20, ROWCH, 1)
	CALL ERSFIELD (80, ROWCH + 1, 1)
	CALL INFIELD (IMGVOL, 80, ROWCH + 1, 1, NEXT)
	L1 = IANYR (IMGVOL, '/')
	L2 = INANYR (IMGVOL, ' ')
	IF (L1 .LT. L2 .AND. L2 .LT. 80) THEN
	  IMGVOL (L2+1:L2+1) = '/'
	  L = L2 + 1
	ELSE
	  L = L2
	ENDIF
	PATHOK = .TRUE.
	IF (L .GT. 0) THEN
	  TMPPATH = CLEAR//CLEAR
d544 7
a550 7
	  TMPPATH (L+1:L+1) = '.'
	  CALL CHKPATH (TMPPATH, L + 1, PATHOK)
	ENDIF
	IF (PATHOK .EQ. .FALSE.) THEN
	  WRITE (USEROUT, *) CHAR (7) 
	  CALL WRTFIELD ('*** ERROR -- Image path does not exist! ***',
     2		43, WARNLINE, 1)
d552 2
a553 14
	ELSE
	  CALL ERSFIELD (43, WARNLINE, 1)
	ENDIF
C
400	CALL WRTFIELD ('Path for HDR files', 18, ROWCH + 2, 1)
	CALL ERSFIELD (80, ROWCH + 3, 1)
	CALL INFIELD (HDRVOL, 80, ROWCH + 3, 1, NEXT)
	L1 = IANYR (HDRVOL, '/')
	L2 = INANYR (HDRVOL, ' ')
	IF (L1 .LT. L2 .AND. L2 .LT. 80) THEN
	  HDRVOL (L2+1:L2+1) = '/'
	  L = L2 + 1
	ELSE
	  L = L2
d555 15
a569 3
	PATHOK = .TRUE.
	IF (L .GT. 0) THEN
	  TMPPATH = CLEAR//CLEAR
d571 3
a573 3
	  TMPPATH (L+1:L+1) = '.'
	  CALL CHKPATH (TMPPATH, L + 1, PATHOK)
	ENDIF
d575 3
a577 3
	  WRITE (USEROUT, *) CHAR (7) 
	  CALL WRTFIELD ('*** ERROR -- Header path does not exist! ***',
     2		44, WARNLINE, 1)
d579 4
a582 3
	ELSE
	  CALL ERSFIELD (44, WARNLINE, 1)
	ENDIF
d594 12
a605 12
	INQUIRE (PRINTER, OPENED = PRINTON)
	IF (PRINTON) CLOSE (PRINTER)
	CALL PRNTFILE (OUTFILE)
      ELSE IF (CH .EQ. 'W' .OR. CH .EQ. 'w') THEN
	CALL WRTFIELD ('Window dump file name', 21, ROWCH, 1)
	CALL ERSFIELD (40, ROWCH + 1, 1)
	CALL INFIELD (DUMPNAME, 40, ROWCH + 1, 1, NEXT)
	L1 = INANYR (DUMPNAME, ' ')
	IF (IANYR (DUMPNAME, ".xwd") .NE. L1 .AND.
     &	  IANYR (DUMPNAME, ".XWD") .NE. L1) THEN
	  XWDEXT = .FALSE.
	  L2 = L1 + 4
d607 6
a612 6
	  XWDEXT = .TRUE.
	  L2 = L1
	ENDIF
	IF (XWDEXT .EQ. .FALSE.) THEN
		DUMPNAME(L1+1:L1+4) = '.xwd'
	ENDIF
d614 1
a614 1
     &	 'you want to save is viewable.', 62, ROWCH + 2, 1)
d616 2
a617 2
     &   	'key s or S to save.', 50, ROWCH + 3, 1)
C
d619 2
a620 2
C
	XWDFLAG = .FALSE.
a622 1
C
d624 1
d644 1
a644 1
C
@


1.1
log
@Initial revision
@
text
@d1 5
a5 2
C $Header: /home/npggw/tom/src/spideram/RCS/main.f,v 1.65 1999/08/09 14:04:36 tom Exp $
C $Log: main.f,v $
d412 1
a412 1
      rcsheader = "$Header: /home/npggw/tom/src/spideram/RCS/main.f,v 1.65 1999/08/09 14:04:36 tom Exp $"
d422 1
a422 1
      DATA VERSION  /'14-Dec-99'/
@
