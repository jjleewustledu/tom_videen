head	1.26;
access;
symbols;
locks; strict;
comment	@c @;


1.26
date	97.06.05.22.01.21;	author tom;	state Exp;
branches;
next	1.25;

1.25
date	97.06.04.19.16.56;	author tom;	state Exp;
branches;
next	1.24;

1.24
date	97.04.24.16.48.06;	author tom;	state Exp;
branches;
next	1.23;

1.23
date	95.05.24.21.57.50;	author ty7777;	state Exp;
branches;
next	1.22;

1.22
date	95.05.24.21.12.30;	author ty7777;	state Exp;
branches;
next	1.21;

1.21
date	94.06.17.21.06.22;	author ty7777;	state Exp;
branches;
next	1.20;

1.20
date	94.06.17.21.02.31;	author ty7777;	state Exp;
branches;
next	1.19;

1.19
date	94.06.17.16.57.16;	author ty7777;	state Exp;
branches;
next	1.18;

1.18
date	94.06.17.16.53.00;	author ty7777;	state Exp;
branches;
next	1.17;

1.17
date	94.06.10.15.50.56;	author ty7777;	state Exp;
branches;
next	1.16;

1.16
date	94.06.06.18.40.09;	author ty7777;	state Exp;
branches;
next	1.15;

1.15
date	94.06.06.17.02.48;	author ty7777;	state Exp;
branches;
next	1.14;

1.14
date	94.04.22.20.34.24;	author ty7777;	state Exp;
branches;
next	1.13;

1.13
date	94.01.21.18.12.16;	author ty7777;	state Exp;
branches;
next	1.12;

1.12
date	94.01.21.17.18.48;	author ty7777;	state Exp;
branches;
next	1.11;

1.11
date	94.01.06.21.28.17;	author ty7777;	state Exp;
branches;
next	1.10;

1.10
date	93.12.28.21.24.24;	author ty7777;	state Exp;
branches;
next	1.9;

1.9
date	93.12.28.16.34.44;	author ty7777;	state Exp;
branches;
next	1.8;

1.8
date	93.12.28.16.26.40;	author ty7777;	state Exp;
branches;
next	1.7;

1.7
date	93.12.22.16.56.56;	author ty7777;	state Exp;
branches;
next	1.6;

1.6
date	93.11.26.23.50.28;	author ty7777;	state Exp;
branches;
next	1.5;

1.5
date	93.11.26.22.41.17;	author ty7777;	state Exp;
branches;
next	1.4;

1.4
date	93.11.23.20.53.47;	author ty7777;	state Exp;
branches;
next	1.3;

1.3
date	93.11.22.22.00.36;	author ty7777;	state Exp;
branches;
next	1.2;

1.2
date	93.11.19.20.29.23;	author ty7777;	state Exp;
branches;
next	1.1;

1.1
date	93.11.17.16.26.15;	author ty7777;	state Exp;
branches;
next	;


desc
@X window version. Initial release.
@


1.26
log
@add custom min-max scaling to t1disp12
@
text
@C$Id: rapture.f,v 1.25 1997/06/04 19:16:56 tom Exp tom $
C$Log: rapture.f,v $
c Revision 1.25  1997/06/04  19:16:56  tom
c add t1clot
c
c Revision 1.24  1997/04/24  16:48:06  tom
c eliminate requirement for 49 or 75 slice images
c permit 0's in ROI with warning message instead of error
c
c Revision 1.23  1995/05/24  21:57:50  ty7777
c Modified the dialog message.
c
c Revision 1.22  1995/05/24  21:12:30  ty7777
c Ask the user for ZORIGIN.
c
c Revision 1.21  1994/06/17  21:06:22  ty7777
c Changed the on screen message.
c
c Revision 1.20  1994/06/17  21:02:31  ty7777
c Changed the messages.
c
c Revision 1.19  1994/06/17  16:57:16  ty7777
c Change the date.
c
c Revision 1.18  1994/06/17  16:53:00  ty7777
c Version work on the PCs.
c
c Revision 1.17  1994/06/10  15:50:56  ty7777
c Added PCFLAG to ramimg ().
c
c Revision 1.16  1994/06/06  18:40:09  ty7777
c Change the date.
c
c Revision 1.15  1994/06/06  17:02:48  ty7777
c Added arguments for ramini ().
c
c Revision 1.14  1994/04/22  20:34:24  ty7777
c Same as the last one.
c
c Revision 1.13  1994/01/21  18:12:16  ty7777
c Changed the copyright message.
c
c Revision 1.12  1994/01/21  17:18:48  ty7777
c Added copyright logo.
c
c Revision 1.11  1994/01/06  21:28:17  ty7777
c Added comments.
c
c Revision 1.10  1993/12/28  21:24:24  ty7777
c Added processing for logfile.
c
c Revision 1.9  1993/12/28  16:34:44  ty7777
c Added documentation.
c
c Revision 1.8  1993/12/28  16:26:40  ty7777
c Added processing for spherical region.
c
c Revision 1.7  1993/12/22  16:56:56  ty7777
c Moved output to LOGOUT2 to LOGOUT.
c
c Revision 1.6  1993/11/26  23:50:28  ty7777
c Before Opening the Primary and Secondary file.
c
c Revision 1.5  1993/11/26  22:41:17  ty7777
c Before adding the midlines.
c
c Revision 1.4  1993/11/23  20:53:47  ty7777
c Added comments.
c
c Revision 1.3  1993/11/22  22:00:36  ty7777
c Changed format for 8010 to 8040.
c
c Revision 1.2  1993/11/19  20:29:23  ty7777
c Changed the date.
c
c Revision 1.1  1993/11/17  16:26:15  ty7777
c Initial revision
c
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C  Program:      rapture.f
C
C  Author:       Tom O. Videen
C  Date:         02-Oct-90
C  Written For:  Regional Analysis of Power of T-statistics
C                Using Replication for Establishment
C
C  History:
C     Modified 19-Oct-90:
C        1) compute power for 2,3,5,10,15%
C        2) use same list files as UTIMAGE, PTIMAGE, DTIMAGE;
C        3) process difference images directly;
C        4) pause after processing in 'O' and 'P'
C     Modified 20-Nov-90:
C        1) changed default parameter in T1CREATE (from 'C' to 'S')
C     Modified 28-Nov-90:
C        1) added automatic successive computation of t option (T1AUTORG);
C        2) T1AUTORG and T1OPTREG may be terminated with "S";
C        3) added T1DISP30 called from T1AUTORG;
C        4) modifications in:  TRAPTURE, T1AUTORG, T1NEXT,
C           T1PAIRED, T1PIXELS, T1OPTREG, T1TPROC, T1UNPAIR;
C        5) modified T1DISP1, T1DISP12, T1DISP30 to use RAMZOOM;
C     Modified 29-Nov-90:
C        1) Fixed some display glitches.
C        2) Fixed some automatic region definition glitches.
C           (RAPTURE, T1AUTORG, T1DISP1, T1DISP12, and T1DISP30)
C     Modified 30-Nov-90:
C        1) Added ZOOMFACTOR in common DISPLAY in .INC file.
C           (T1CURSOR, T1LIMIT, T1TRIM, T1DISP1, T1DISP12, T1DISP30)
C        2) Changed MAG to 1 in T1CREATE.
C        3) Added 'L' = zero limit option to menu.
C     Modified 03-Dec-90:
C        1) Display parameters initialized in MAIN, and not in T1CREATE.
C           (reinitialized in T1DISP1, T1DISP12, and T1DISP30)
C     Modified 04-Dec-90:
C        1) Minor alterations in T1AUTORG, T1DISP1, T1CREATE, T1OPTREG,
C           T1TPROC, T1PAIRED, and T1UNPAIR.
C     Modified 07-Dec-90:
C        1) Fixed bug in zeroing limits (RAPTURE).
C        2) Reduced output in T1UNPAIR so power analysis fits on 1 screen.
C     Modified 10-Dec-90:
C        1) Removed output comment in T1AUTORG, T1OPTREG.
C     Modified 11-Dec-90:
C        1) Added subroutine T1SINGLE with main menu option 'I'.
C     Modified 24-Jan-91:
C        1) Allow a single list of UNPAIRED data to be entered with N2=0
C           so as to compute mean regional values but not t-values.
C           (T1NFILES, T1UNPAIR)
C     Modified 28-Feb-91:
C        1) Zero SETB when region list zeroed.
C           (RAPTURE, T1AUTORG)
C     Modified 20-Jun-91:
C        1) Fix T1SINGLE to process UNPAIRED lists properly.
C        2) Change 'O' option to call T1AUTORG.
C        3) Change 'C' option to call T1OPTREG.
C           (RAPTURE, T1SINGLE)
C     Modified 27-Jun-91:
C        1) Fix date written in TRG file (T1SAVREG)
C        2) Add limit to RPIXELS to stop T1AUTORG.
C     Modified 05-Nov-91 and 06-Nov-91:
C        1) Add option to create weighted VOIs;
C        2) If DIFFERENCE images are read, zero pixels are OK;
C        3) Eliminate T1CREATE.
C        4) Alter LOGOUT and LOGOUT2 writes and make both files optional.
C     Modified 12-Nov-91 to alway call T1TOTAL before saving ROI
C        and before calling T1TPROC.
C     Modified 20-Nov-91 to read old TRG files (T1GETREG).
C     Modified 09-Dec-91 to handle UNPAIRED DIFFERENCE image sets
C        (T1NFILES)
C     Modified 12-Dec-91 to used MASKFILE in prior to computing regional
C        stats and means (T1SUM, T1TOTAL)
C     Modified 13-Dec-91:
C        1) Minimize warning for masked pixel (T1SUM, T1TOTAL);
C        2) Fix direction of log output to appropriate files;
C     Modified 19-Nov-93 by Tom Yang:
C        Ported to X window and UNIX environment.
C     Modified 22-Nov-93 by Tom Yang:
C        Changed format for 8010, 8020, 8030, 8040. 
C     Modified 24-Nov-93 by Tom Yang:
C        Changed RAMINI (). Use color table 42.
C     Modified 23-Dec-93 by Tom Yang:
C        1) Moved all LOGOUT2 output to LOGOUT.
C        2) Deleted unused variables NSLICES, SLC,
C     Modified 27-Dec-93 by Tom Yang:
C        1) Added interface and processing for spherical regions.
C        2) Added FORTRAN funtion T1SPHERI () and C function proj2d ().
C     Modified 28-Dec-93 by Tom Yang to check the existence of logfile.
C     Modified 06-Jan-93 by Tom Yang to trim pixels by mouse.
C        1) t1rempnt.f is changed.
C        2) t1trim.f is changed.
C     Modified 06-June-94 by Tom Yang to add arguments fro ramini ().
C     Modified 10-June-94 by Tom Yang to add PCFLAG to ramimg ().
C     Modified 17-June-94 by Tom Yang to let program work on the PCs.
C     Modified 23-May-95 by Tom Yang to define ZORIGIN at the begining of the program
C     Modified Apr-97 TOV to eliminate 49,75 slice requirement.
C     Modified May-97 TOV to add rim ROI definition to t1region
C
C  Intent:
C     Display slices of 49-slice PETT VI t-image files.
C     Create, display, and compute statistical values on irregular
C        regions over multiple adjacent slices.
C
C  Uses:
C     T1AUTORG - compute t for successive regions (auto OPTREG)
C     T1DISP12 - display a region in 4x3 format (12 frames)
C     T1GETREG - get region from disk file
C     T1NFILES - get a list of files for processing
C     T1OPTREG - determine optimal region size
C     T1SAVREG - save region in disk file
C     T1SCALE  - define scaler for displayed image
C     T1SINGLE - determine mean regional value for single images (or pairs)
C     T1TOTAL  - determine totals for entire region
C     T1TPROC  - process set of files for t
C     T1WEIGHT
C
C  RAMUTY.LIB
C     RAMRST   - reset Ramtek;
C
C  TERMINAL.LIB
C     GETCHAR
C     YESNO
C
C  Compile/Link with: RAPTURE.CMP, RAPTURE.LNK
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
      PROGRAM RAPTURE
C
      INTEGER*4     AUXLU        ! lu for input from CSS
      INTEGER*4     IMIN, IMAX   ! min and max pixel values
      INTEGER*4     MAXSLICE     ! slice where max regional value is found
      INTEGER*4     ROWCH, COLCH ! location of the field for entering CH
      INTEGER*4     EXECMD       ! flag used to exec command
      INTEGER*4     L            ! used from eliminating spaces
C
      REAL*4        MEAN, SD  ! mean, SD
      REAL*4        TEMP      ! local for NORMVAL
C
      CHARACTER*1   CH        ! input character
      CHARACTER*1   BELL
      CHARACTER*20  NULL      ! blank string
      CHARACTER*20  TEMPNAME  ! temp for CFNAME
      CHARACTER*38  MENU (17) ! main menu
      CHARACTER*40  PCSTR     ! string containing the option "-pc"
      CHARACTER*80  CHARSET   ! character set valid for GETCHAR
      CHARACTER*80  Q         ! query to user
      CHARACTER*80  STR       ! string
      CHARACTER*256 LIBPATH   ! directory where the color tables and data files are located
      CHARACTER*256 LOGFILE   ! primary log file name
      CHARACTER*256 RGNFILE   ! 3d region file.
      CHARACTER*256 RCSHEADER       
C
      LOGICAL*1     A         ! answer
C
      INCLUDE 'rapture.inc'
C  
C  Initialize
C
      DATA AUXLU, DISK, FILELIST, LOGOUT /1, 2, 3, 4/
      DATA USERIN, USEROUT, MASK, RGNDISK, RMD /5, 6, 8, 9, 10/
      DATA FONT1C, FONT2C /1, 2/
      DATA ROWCH, COLCH /26, 1/
C
      RCSHEADER = '$Header: /home/npggw/tom/src/rapture/RCS/rapture.f,v 1.25 1997/06/04 19:16:56 tom Exp tom $'
C
C     Get the command line arguments.
C
      CALL GETARG (1, LIBPATH)
      CALL GETARG (2, LOGFILE)
      CALL GETARG (3, RGNFILE)
      CALL GETARG (4, PCSTR)
      IF (PCSTR .EQ. "-pc") THEN
	PCFLAG = 1
      ELSE
	PCFLAG = 0
      ENDIF

110   OPEN (LOGOUT, FILE = LOGFILE, STATUS = 'NEW', ERR = 120)
      GOTO 102
120   OPEN (LOGOUT, FILE = LOGFILE, STATUS = 'OLD', ERR = 101)
      L = INANYR (LOGFILE, ' ')
      WRITE (USEROUT, *) '*** Log file ', LOGFILE (1:L),' exists ***', CHAR (7)
      Q = ' Replace this file'
      A = .FALSE.
      CALL YESNO (Q, A)
      IF (A) THEN
        CLOSE (LOGOUT, STATUS = 'DELETE')
        GO TO 110
      ELSE
        GO TO 101
      END IF
C
101   WRITE (USEROUT, *)'*****ERROR OPENING LOGFILE FILE*****'
      STOP

102   OPEN (RGNDISK, FILE = RGNFILE, STATUS = 'OLD', ERR = 103)
      GO TO 104
103   WRITE (*,*) '*** Cannot Open Region File: ', RGNFILE
      STOP
104   CONTINUE
C
C      OPLANE = 2**9
C      PLANE  = 2**10
C      LPLANE = 2**11
      OPLANE = 2**12
      PLANE  = 2**12 - 1
      LPLANE = 2**12
      SCALER = 1.0
      SIGN   = 1
      RADIUS = 3
      UNPAIRED = .FALSE.
      SPHERICAL = .FALSE.
      DIFF   = .FALSE.
      BELL = CHAR(7)
      CH = 'S'
      SFNAME = ' '
      CFNAME = ' '
      LISTNAME = ' '
      MASKNAME = ' '
      REGNAME = ' '
      DO 10 I=1,100
        FNAME(I) = ' '
10    CONTINUE
      FNUM = 1
      SLICE = 0
      XSEED = 0
      YSEED = 0
      ZSEED = 0
      ZMIN = 0
      ZMAX = 0
      XST = 0
      YST = 0
      MAG = 1
      SIZE = 100
      ZOOMFACTOR = 5
      XFIRST = 15
      XLAST = XFIRST + SIZE - 1
      YFIRST = 15
      YLAST = YFIRST + SIZE - 1
      MAXTHRESH = 0
      TVAL = 0.
      NORMVAL = 1000.
      ZORIGIN = 31
      NULL = ' '
      DO 30 J=1,128
        DO 20 I=1,128
          SETA(I,J) = .FALSE.
          SETB(I,J) = .FALSE.
          SETC(I,J) = .FALSE.
          SETM(I,J) = 1
20      CONTINUE
30    CONTINUE
C
C  Zero limit list
C
      DO 40 I=1,500
        LM(1,I) = 0
        LM(2,I) = 0
40    CONTINUE
      LIMIT = 0
      DO 60 J=1,128
        DO 50 I=1,128
          SETC(I,J) = .FALSE.
50      CONTINUE
60    CONTINUE
C
C  Zero region list
C
      CALL T1ZERORG
      MAXT = 0.
      THRESHMAXT = 0
C
C  Menu
C
      MENU(1) = 'M = Masking file for regions:        '
      MENU(2) = 'S = Scaler from image max'
      MENU(3) = 'A = Absolute scaler'
      MENU(4) = 'R = Region generation'
      MENU(5) = 'D = Display a region'
      MENU(6) = 'G = Get a region'
      MENU(7) = 'F = File a region'
      MENU(8) = 'T = Totals & stats for current region'
      MENU(9) = 'O = Optimize region size'
      MENU(10)= 'P = Process set of input files'
      MENU(11)= 'C = Create a contiguous region'
      MENU(12)= 'I = Individual image regional values'
      MENU(13)= 'Z = Zero current region list'
      MENU(14)= 'L = Zero current limits'
      MENU(15)= 'W = Recompute region weights'
      MENU(16)= '0 = Refresh Ramtek'
      MENU(17)= 'X = Exit'
C
C  Get terminal type for terminal control subroutines
C
      CALL TERMSET (AUXLU, LIBPATH)
C
      Q = 'Images normalized to'
      TEMP = NORMVAL
      CALL GETREAL (Q, TEMP, 1.0, 10000.0)
      NORMVAL = TEMP

      Q = ' Z origin slice is'
      L = ZORIGIN
      CALL GETINT (Q, L, 1, 100)
      ZORIGIN = L
C
C  Initialize the Ramtek
C
      CALL RAMINI (0, 20, 1200, 1000, 42, PCFLAG, LIBPATH)
      CALL RAMRST (RMD)
C
C  -------------------------------------------------------------------
C  Refresh terminal and write menu
C
100   CALL TCONTROL (1, 0, 0)
      CALL TCONTROL (2, 0, 0)
      IF (PCFLAG .EQ. 1) THEN
        WRITE (USEROUT, *) '***  pcrapture {Jun-97} ***',
     &   '                               << MAIN MENU >>'
      ELSE
        WRITE (USEROUT, *) '***  rapture {Jun-97} ***',
     &   '                                 << MAIN MENU >>'
      ENDIF
      WRITE (USEROUT, *) 
      WRITE (USEROUT, *) 'Copyright 1990-1997, Washington University.'
      WRITE (USEROUT, *) 'All rights reserved. Unauthorized reproduction prohibited.'
      WRITE (USEROUT, *) 
200   WRITE (USEROUT, *) MENU (1), MASKNAME (1:20)
      DO 300 I = 2, 17
        WRITE (USEROUT, *) MENU (I)
300   CONTINUE
      WRITE (USEROUT, *) '-------------------------------------'
      Q = 'Selection'
      CHARSET = 'MSARDGFTIZLWOPCXmsardgftzilwopcx0'
      CALL GETCHAR(Q,CH,CHARSET)
C
      IF (CH.EQ.'S' .OR. CH.EQ.'s') THEN
        CALL T1SCALE
C
      ELSE IF (CH.EQ.'A' .OR. CH.EQ.'a') THEN
        Q = 'Scale to image max/min of'
        TEMP = 240./SCALER
        CALL GETREAL(Q,TEMP,-32767.,32767.)
        SCALER =240./TEMP
C
      ELSE IF (CH .EQ. 'M' .OR. CH .EQ. 'm') THEN
        Q = 'Masking file name (enter "ESC RETURN" to reset to null)'
        STR = MASKNAME (1:20)
        CALL GTSTRING (Q, STR)
        MASKNAME = STR (1:20)
        IF (MASKNAME .EQ. NULL) THEN
          DO 330 J = 1, 128
            DO 320 I = 1, 128
              SETM (I, J) = 1
320         CONTINUE
330       CONTINUE
        END IF
C
      ELSE IF (CH.EQ.'R' .OR. CH.EQ.'r') THEN
        CALL T1REGION
C
      ELSE IF (CH.EQ.'G' .OR. CH.EQ.'g') THEN
        CALL TCONTROL(1,0,0)
        CALL TCONTROL(2,0,0)
        CALL T1GETREG
        GO TO 200
C
      ELSE IF (CH.EQ.'F' .OR. CH.EQ.'f') THEN
        CFNAME = SFNAME
        CALL T1TOTAL(MEAN,SD,IMIN,IMAX,MAXSLICE)
        CALL T1SAVREG
C
      ELSE IF (CH.EQ.'D' .OR. CH.EQ.'d') THEN
        Q = 'Image file name'
        STR = CFNAME
        CALL GTSTRING(Q,STR)
        IF (STR(1:6).EQ.'CANCEL') THEN
          CALL TCONTROL(1,0,0)
          CALL TCONTROL(2,0,0)
          GO TO 200
        END IF
        CFNAME = STR(1:20)
        IF (CFNAME.EQ.NULL) THEN
          CALL TCONTROL(1,0,0)
          CALL TCONTROL(2,0,0)
          GO TO 200
        END IF
        IF (RPIXELS.EQ.0) THEN
          CALL TCONTROL(1,0,0)
          CALL TCONTROL(2,0,0)
          WRITE(USEROUT,*) 'No region is defined',BELL
          GO TO 200
        ELSE
          CALL T1DISP12
        END IF
C
      ELSE IF (CH.EQ.'T' .OR. CH.EQ.'t') THEN
        CALL TCONTROL (1, 0, 0)
        CALL TCONTROL (2, 0, 0)
        IF (CFNAME .EQ. NULL) THEN
          WRITE (USEROUT, *) 'No image file has been entered', BELL
        ELSE IF (RPIXELS .EQ. 0) THEN
          WRITE (USEROUT, *) 'No region is defined', BELL
        ELSE
          Q = 'Weight pixel values by magnitude'
          CALL YESNO (Q, WEIGHTVOI)
          CALL T1TOTAL (MEAN, SD, IMIN, IMAX, MAXSLICE)
          WRITE (USEROUT, 8000)
          WRITE (USEROUT, 8010) CFNAME (1:20), ZMIN, ZMAX
          WRITE (USEROUT, 8020) THRESH, IMIN, IMAX, MAXSLICE
          WRITE (USEROUT, 8030) XCTR, YCTR, ZCTR
          WRITE (USEROUT, 8040) MEAN, SD, RPIXELS
          WRITE (USEROUT, 8000)
          WRITE (LOGOUT, 8000)
          WRITE (LOGOUT, 8010) CFNAME (1:20), ZMIN, ZMAX
          WRITE (LOGOUT, 8020) THRESH, IMIN, IMAX, MAXSLICE
          WRITE (LOGOUT, 8030) XCTR, YCTR, ZCTR
          WRITE (LOGOUT, 8040) MEAN, SD, RPIXELS
          WRITE (LOGOUT, 8000)
        END IF
        GO TO 200
C
8000    FORMAT(1X,'------------------------------------------',
     &      '-----------------------------')
8010    FORMAT (1X, 'File = ', A, '   Slices: ', I3, ' to ', I3)
8020    FORMAT (1X, 'Inclusion Threshold =', I5, 5X,
     &    'Range: ', I8, ' to ', I8, 5X, 'Peak in Slice ', I3)
8030    FORMAT (1X, 'Stereotactic Center of Mass (X, Y, Z) = ', 3(2X, F6.2))
8040    FORMAT (1X, 'Mean =', F10.3, 4X, 'SD = ', F10.4, 4X, 'Pixels = ', I5)
C
      ELSE IF (CH.EQ.'Z' .OR. CH.EQ.'z') THEN
        CALL T1ZERORG
        MAXT = 0.
        THRESHMAXT = 0
C
      ELSE IF (CH.EQ.'L' .OR. CH.EQ.'l') THEN
        DO 400 I=1,500
          LM(1,I) = 0
          LM(2,I) = 0
400     CONTINUE
        LIMIT = 0
        DO 420 J=1,128
          DO 410 I=1,128
            SETC(I,J) = .FALSE.
410       CONTINUE
420     CONTINUE
C
      ELSE IF (CH.EQ.'W' .OR. CH.EQ.'w') THEN
        CALL T1WEIGHT
C
      ELSE IF (CH.EQ.'C' .OR. CH.EQ.'c') THEN
        TEMPNAME = CFNAME
        CALL T1NFILES
        IF (N1.GT.0) CALL T1OPTREG
        CFNAME = TEMPNAME
        WRITE(USEROUT,*)
        A = .TRUE.
        Q = '... continue'
        CALL YESNO(Q,A)
        GO TO 200
C
      ELSE IF (CH.EQ.'O' .OR. CH.EQ.'o') THEN
        CALL T1ZERORG
        MAXT = 0.
        THRESHMAXT = 0
        TEMPNAME = CFNAME
        CALL T1NFILES
        IF (N1 .GT. 0) CALL T1AUTORG
        CFNAME = TEMPNAME
        A = .TRUE.
        Q = '... continue'
        CALL YESNO (Q, A)
        GO TO 100
C
      ELSE IF (CH .EQ. 'P' .OR. CH .EQ. 'p') THEN
        TEMPNAME = CFNAME
        Q = 'Weight pixel values by magnitude'
        CALL YESNO (Q, WEIGHTVOI)
        CALL T1NFILES
        CALL T1TOTAL (MEAN, SD, IMIN, IMAX, MAXSLICE)
        IF (N1 .GT. 0) CALL T1TPROC
        CFNAME = TEMPNAME
        A = .TRUE.
        Q = '... continue'
        CALL YESNO (Q, A)
        GO TO 200
C
      ELSE IF (CH.EQ.'I' .OR. CH.EQ.'i') THEN
        TEMPNAME = CFNAME
        CALL T1NFILES
        IF (N1.GT.0) CALL T1SINGLE
        CFNAME = TEMPNAME
        WRITE(USEROUT,*)
        A = .TRUE.
        Q = '... continue'
        CALL YESNO (Q, A)
        GO TO 200
C
      ELSE IF (CH.EQ.'0') THEN
        CALL RAMRST(RMD)
C
      ELSE IF (CH .EQ. 'X' .OR. CH .EQ. 'x') THEN
        Q = 'EXIT?'
        CALL QUERY (Q, A, ROWCH, COLCH)
        CALL ERSFIELD (10, ROWCH, COLCH)
        IF (A) THEN
	  EXECMD = 0
          CALL XRAMEXIT ('None', EXECMD)
	  CLOSE (LOGOUT)
	  CLOSE (RGNDISK)
          STOP
        ELSE
          GO TO 100
        END IF
      END IF
      GO TO 100
C
      END
@


1.25
log
@add t1clot
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.24 1997/04/24 16:48:06 tom Exp $
d3 3
d244 1
a244 1
      RCSHEADER = '$Header: /home/npggw/tom/src/rapture/RCS/rapture.f,v 1.24 1997/04/24 16:48:06 tom Exp $'
d398 1
a398 1
        WRITE (USEROUT, *) '***  pcrapture {May-97} ***',
d401 1
a401 1
        WRITE (USEROUT, *) '***  rapture {May-97} ***',
d405 1
a405 1
      WRITE (USEROUT, *) 'Copyright 1990-1994, Washington University.'
@


1.24
log
@eliminate requirement for 49 or 75 slice images
permit 0's in ROI with warning message instead of error
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.23 1995/05/24 21:57:50 ty7777 Exp tom $
d3 4
d173 1
d241 1
a241 1
      RCSHEADER = '$Header: /home/npggw/tom/src/rapture/RCS/rapture.f,v 1.23 1995/05/24 21:57:50 ty7777 Exp tom $'
d395 1
a395 1
        WRITE (USEROUT, *) '***  pcrapture {Apr-97} ***',
d398 1
a398 1
        WRITE (USEROUT, *) '***  rapture {Apr-97} ***',
@


1.23
log
@Modified the dialog message.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.22 1995/05/24 21:12:30 ty7777 Exp ty7777 $
d3 3
d72 2
a73 3
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
d167 2
a168 2
C     Modified 23-May-95 by Tom Yang to define ZORIGIN at the begining of the
C	program.
a200 2
C
C
d236 1
a236 1
      RCSHEADER = '$Header: /data/petsun4/src/rapture/RCS/rapture.f,v 1.22 1995/05/24 21:12:30 ty7777 Exp ty7777 $'
d390 1
a390 1
        WRITE (USEROUT, *) '***  pcrapture {23-May-95} ***',
d393 1
a393 1
        WRITE (USEROUT, *) '***  rapture {23-May-95} ***',
@


1.22
log
@Ask the user for ZORIGIN.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.21 1994/06/17 21:06:22 ty7777 Exp ty7777 $
d3 3
d236 1
a236 1
      RCSHEADER = '$Header: /data/petsun4/src/rapture/RCS/rapture.f,v 1.21 1994/06/17 21:06:22 ty7777 Exp ty7777 $'
d255 1
a255 1
      Q = 'Replace this file'
d374 1
a374 1
      Q = 'Z origin slice is'
@


1.21
log
@Changed the on screen message.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.20 1994/06/17 21:02:31 ty7777 Exp ty7777 $
d3 3
d162 2
d233 1
a233 1
      RCSHEADER = '$Header: /home/petsun4/ty7777/src/rapture/RCS/rapture.f,v 1.20 1994/06/17 21:02:31 ty7777 Exp ty7777 $'
d312 1
d370 5
d387 1
a387 1
        WRITE (USEROUT, *) '***  pcrapture {17-Jun-94} ***',
d390 1
a390 1
        WRITE (USEROUT, *) '***  rapture {17-Jun-94} ***',
@


1.20
log
@Changed the messages.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.19 1994/06/17 16:57:16 ty7777 Exp ty7777 $
d3 3
d228 1
a228 1
      RCSHEADER = '$Header: /home/petsun4/ty7777/src/rapture/RCS/rapture.f,v 1.19 1994/06/17 16:57:16 ty7777 Exp ty7777 $'
d376 3
a380 3
      ELSE
        WRITE (USEROUT, *) '***  pcrapture {17-Jun-94} ***',
     &   '                               << MAIN MENU >>'
@


1.19
log
@Change the date.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.18 1994/06/17 16:53:00 ty7777 Exp ty7777 $
d3 3
d225 1
a225 1
      RCSHEADER = '$Header: /home/petsun4/ty7777/src/rapture/RCS/rapture.f,v 1.18 1994/06/17 16:53:00 ty7777 Exp ty7777 $'
d372 2
a373 1
      WRITE (USEROUT, *) '***  rapture {17-Jun-94} ***',
d375 4
@


1.18
log
@Version work on the PCs.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.17 1994/06/10 15:50:56 ty7777 Exp ty7777 $
d3 3
d222 1
a222 1
      RCSHEADER = '$Header: /home/petsun4/ty7777/src/rapture/RCS/rapture.f,v 1.17 1994/06/10 15:50:56 ty7777 Exp ty7777 $'
d369 1
a369 1
      WRITE (USEROUT, *) '***  rapture {10-Jun-94} ***',
@


1.17
log
@Added PCFLAG to ramimg ().
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.16 1994/06/06 18:40:09 ty7777 Exp ty7777 $
d3 3
d149 1
d198 2
a199 1
      CHARACTER*38  MENU(17)  ! main menu
d203 1
d214 1
a214 1
      DATA AUXLU, DISK, FILELIST, LOGOUT /0, 1, 2, 3/
d219 1
a219 1
      RCSHEADER = '$Header$'
d221 11
a231 2
      CALL GETARG (1, LOGFILE)
      CALL GETARG (2, RGNFILE)
a290 1
      PCFLAG = 0
d349 1
a349 1
      CALL TERMSET(AUXLU)
d353 1
a353 1
      CALL GETREAL(Q,TEMP,1.,10000.)
d358 1
a358 1
      CALL RAMINI (0, 20, 1200, 1000, 42, 0, RMD)
@


1.16
log
@Change the date.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.15 1994/06/06 17:02:48 ty7777 Exp ty7777 $
d3 3
d145 1
d213 1
a213 1
      RCSHEADER = '$Id: rapture.f,v 1.15 1994/06/06 17:02:48 ty7777 Exp ty7777 $'
d276 1
d344 1
a344 1
      CALL RAMINI (0, 20, 1200, 1000, 42)
d352 1
a352 1
      WRITE (USEROUT, *) '***  rapture {06-Jun-94} ***',
@


1.15
log
@Added arguments for ramini ().
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.14 1994/04/22 20:34:24 ty7777 Exp ty7777 $
d3 3
d209 1
a209 1
      RCSHEADER = '$Id: rapture.f,v 1.14 1994/04/22 20:34:24 ty7777 Exp ty7777 $'
d347 1
a347 1
      WRITE (USEROUT, *) '***  rapture {22-Jan-94} ***',
@


1.14
log
@Same as the last one.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.13 1994/01/21 18:12:16 ty7777 Exp ty7777 $
d3 3
d138 1
d206 1
a206 1
      RCSHEADER = '$Id: rapture.f,v 1.13 1994/01/21 18:12:16 ty7777 Exp ty7777 $'
d336 1
a336 1
      CALL RAMINI (42)
@


1.13
log
@Changed the copyright message.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.12 1994/01/21 17:18:48 ty7777 Exp ty7777 $
d3 3
d202 1
a202 1
      RCSHEADER = '$Id: rapture.f,v 1.12 1994/01/21 17:18:48 ty7777 Exp ty7777 $'
@


1.12
log
@Added copyright logo.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.11 1994/01/06 21:28:17 ty7777 Exp ty7777 $
d3 3
d199 1
a199 1
      RCSHEADER = '$Id: rapture.f,v 1.11 1994/01/06 21:28:17 ty7777 Exp ty7777 $'
d340 1
a340 1
      WRITE (USEROUT, *) 'Copyright 1990-1994, Washington University Neuroscience Imageing Group.'
@


1.11
log
@Added comments.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.10 1993/12/28 21:24:24 ty7777 Exp ty7777 $
d3 3
d194 1
a194 1
      DATA ROWCH, COLCH /23, 1/
d196 1
a196 1
      RCSHEADER = '$Id: rapture.f,v 1.10 1993/12/28 21:24:24 ty7777 Exp ty7777 $'
d334 1
a334 1
      WRITE (USEROUT, *) '***  RAPTURE {06-Jan-94} ***',
d336 3
@


1.10
log
@Added processing for logfile.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.9 1993/12/28 16:34:44 ty7777 Exp ty7777 $
d3 3
d123 3
d193 1
a193 1
      RCSHEADER = '$Id: rapture.f,v 1.9 1993/12/28 16:34:44 ty7777 Exp ty7777 $'
d331 1
a331 1
      WRITE (USEROUT, *) '***  RAPTURE {28-Dec-93} ***',
@


1.9
log
@Added documentation.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.8 1993/12/28 16:26:40 ty7777 Exp ty7777 $
d3 3
d119 1
d159 1
d172 1
a172 1
      CHARACTER*80  LOGFILE   ! primary log file name
d187 1
a187 1
      RCSHEADER = '$Id: rapture.f,v 1.8 1993/12/28 16:26:40 ty7777 Exp ty7777 $'
d192 1
a192 1
      OPEN (LOGOUT, FILE = LOGFILE, STATUS = 'NEW', ERR = 101)
d194 13
d496 1
a496 1
        CALL YESNO(Q,A)
@


1.8
log
@Added processing for spherical region.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.7 1993/12/22 16:56:56 ty7777 Exp ty7777 $
d3 3
d115 1
d182 1
a182 1
      RCSHEADER = '$Id: rapture.f,v 1.7 1993/12/22 16:56:56 ty7777 Exp ty7777 $'
d307 1
a307 1
      WRITE (USEROUT, *) '***  RAPTURE {26-Nov-93} ***',
@


1.7
log
@Moved output to LOGOUT2 to LOGOUT.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.6 1993/11/26 23:50:28 ty7777 Exp ty7777 $
d3 3
d110 2
d164 1
d174 1
a174 1
      DATA USERIN, USEROUT, MASK, RMD /5, 6, 8, 10/
d178 1
a178 1
      RCSHEADER = '$Id: rapture.f,v 1.6 1993/11/26 23:50:28 ty7777 Exp ty7777 $'
d181 1
d188 5
a192 1
102   CONTINUE
d202 1
d204 1
d488 1
@


1.6
log
@Before Opening the Primary and Secondary file.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.5 1993/11/26 22:41:17 ty7777 Exp ty7777 $
d3 3
d104 3
a140 1
      INTEGER*4     NSLICES      ! number of slices
a143 1
      INTEGER*4     SLC          ! local for slice
d158 1
a158 2
      CHARACTER*80  PRIMARY   ! primary log file name
      CHARACTER*80  SECONDARY ! secondary log file name
a161 2
      LOGICAL*1     SAVE_PRIMARY         
      LOGICAL*1     SAVE_SECONDARY         
a164 15
      CALL GETARG (1, PRIMARY)
      CALL GETARG (2, SECONDARY)

      IF (PRIMARY .EQ. "") THEN
	SAVE_PRIMARY = .FALSE.
      ELSE
	SAVE_PRIMARY = .TRUE.
      ENDIF

      IF (SECONDARY .EQ. "") THEN
	SAVE_SECONDARY = .FALSE.
      ELSE
	SAVE_SECONDARY = .TRUE.
      ENDIF
C
d168 1
a168 1
      DATA USERIN, USEROUT, LOGOUT2, MASK, RMD /5, 6, 7, 8, 10/
d172 1
a172 1
      RCSHEADER = '$Id: rapture.f,v 1.5 1993/11/26 22:41:17 ty7777 Exp ty7777 $'
d174 9
d474 1
@


1.5
log
@Before adding the midlines.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.4 1993/11/23 20:53:47 ty7777 Exp ty7777 $
d3 3
d154 2
d159 2
d162 17
a180 1
      INCLUDE 'rapture.inc'
d186 1
a186 1
      RCSHEADER = '$Id: rapture.f,v 1.4 1993/11/23 20:53:47 ty7777 Exp ty7777 $'
d297 1
a297 1
      WRITE (USEROUT, *)
@


1.4
log
@Added comments.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.3 1993/11/22 22:00:36 ty7777 Exp ty7777 $
d3 3
d96 2
d132 7
a138 5
      INTEGER*4     NSLICES   ! number of slices
      INTEGER*4     AUXLU     ! lu for input from CSS
      INTEGER*4     IMIN, IMAX! min and max pixel values
      INTEGER*4     MAXSLICE  ! slice where max regional value is found
      INTEGER*4     SLC       ! local for slice
d161 1
d163 1
a163 1
      RCSHEADER = '$Id: rapture.f,v 1.3 1993/11/22 22:00:36 ty7777 Exp ty7777 $'
d264 1
a264 1
      CALL RAMINI (RMD)
d272 1
a272 1
      WRITE (USEROUT, *) '***  RAPTURE {20-Nov-93} ***',
d275 1
a275 1
200   WRITE (USEROUT, *) MENU (1), MASKNAME
d293 1
a293 1
      ELSE IF (CH.EQ.'M' .OR. CH.EQ.'m') THEN
d295 7
a301 7
        STR = MASKNAME
        CALL GTSTRING(Q,STR)
        MASKNAME = STR(1:20)
        IF (MASKNAME.EQ.NULL) THEN
          DO 330 J=1,128
            DO 320 I=1,128
              SETM(I,J) = 1
d415 1
a415 1
        IF (N1.GT.0) CALL T1AUTORG
d419 2
a420 2
        CALL YESNO(Q,A)
        GO TO 200
d449 11
a459 2
      ELSE IF (CH.EQ.'X' .OR. CH.EQ.'x') THEN
        STOP
@


1.3
log
@Changed format for 8010 to 8040.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.2 1993/11/19 20:29:23 ty7777 Exp ty7777 $
d3 3
d89 1
a89 1
C     Modified 19-Nov-93:
d91 1
a91 1
C     Modified 22-Nov-93:
d155 1
a155 1
      RCSHEADER = '$Id: rapture.f,v 1.2 1993/11/19 20:29:23 ty7777 Exp ty7777 $'
d414 1
a414 1
      ELSE IF (CH.EQ.'P' .OR. CH.EQ.'p') THEN
d417 1
a417 1
        CALL YESNO(Q,WEIGHTVOI)
d419 2
a420 2
        CALL T1TOTAL(MEAN,SD,IMIN,IMAX,MAXSLICE)
        IF (N1.GT.0) CALL T1TPROC
d424 1
a424 1
        CALL YESNO(Q,A)
@


1.2
log
@Changed the date.
@
text
@d1 1
a1 1
C$Id: rapture.f,v 1.1 1993/11/17 16:26:15 ty7777 Exp ty7777 $
d3 3
d86 4
d152 1
a152 1
      RCSHEADER = '$Id: rapture.f,v 1.1 1993/11/17 16:26:15 ty7777 Exp ty7777 $'
d334 6
a339 6
        CALL TCONTROL(1,0,0)
        CALL TCONTROL(2,0,0)
        IF (CFNAME.EQ.NULL) THEN
          WRITE(USEROUT,*) 'No image file has been entered',BELL
        ELSE IF (RPIXELS.EQ.0) THEN
          WRITE(USEROUT,*) 'No region is defined',BELL
d342 14
a355 14
          CALL YESNO(Q,WEIGHTVOI)
          CALL T1TOTAL(MEAN,SD,IMIN,IMAX,MAXSLICE)
          WRITE(USEROUT,8000)
          WRITE(USEROUT,8010) CFNAME,ZMIN,ZMAX
          WRITE(USEROUT,8020) THRESH,IMIN,IMAX,MAXSLICE
          WRITE(USEROUT,8030) XCTR,YCTR,ZCTR
          WRITE(USEROUT,8040) MEAN,SD,RPIXELS
          WRITE(USEROUT,8000)
          WRITE(LOGOUT,8000)
          WRITE(LOGOUT,8010) CFNAME,ZMIN,ZMAX
          WRITE(LOGOUT,8020) THRESH,IMIN,IMAX,MAXSLICE
          WRITE(LOGOUT,8030) XCTR,YCTR,ZCTR
          WRITE(LOGOUT,8040) MEAN,SD,RPIXELS
          WRITE(LOGOUT,8000)
d361 5
a365 5
8010    FORMAT(1X,'File = ',A,'   Slices: ',I,'to ',I)
8020    FORMAT(1X,'Inclusion Threshold =',I5,5X,
     &    'Range: ',I,' to ',I,5X,'Peak in Slice ',I)
8030    FORMAT(1X,'Stereotactic Center of Mass (X,Y,Z) = ',3(2X,F6.2))
8040    FORMAT(1X,'Mean =',F10.3,4X,'SD = ',F10.4,4X,'Pixels = ',I)
@


1.1
log
@Initial revision
@
text
@d1 5
a5 2
C$Id$
C$Log$
a11 1
C		 Tom Yang (X window version)
d145 1
a145 1
      RCSHEADER = '$Id$'
d252 3
a254 3
100   CALL TCONTROL(1,0,0)
      CALL TCONTROL(2,0,0)
      WRITE(USEROUT,*) '***  RAPTURE {13-Dec-91} ***',
d256 4
a259 4
      WRITE(USEROUT,*)
200   WRITE(USEROUT,*) MENU(1),MASKNAME
      DO 300 I=2,17
        WRITE(USEROUT,*) MENU(I)
d261 1
a261 1
      WRITE(USEROUT,*) '-------------------------------------'
@
